---
title: "Exercise 1 (20 minutes)"
subtitle: "When you're done, assist some of the others ..."
output: webexercises::webexercises_default
---

```{r setup, include = FALSE}
options(htmltools.dir.version = FALSE, servr.interval = 0.5, width = 115, digits = 2)
knitr::opts_chunk$set(
  collapse = TRUE, message = FALSE, 
  warning = FALSE, cache = FALSE,
  comment = "#", strip.white = TRUE)

library(webexercises)
library(tidyverse)
library(essentials)
```

1. Download the APAX survey from Absalon and replicate my operationalization of the variables.
  
`r hide("R solution -> dont' peak to early ;) !")`
```{r}
pacman::p_load(
  tidyverse, # Data manipulation,
  furniture, # For row-means,
  ggplot2, # beautiful figures,
  estimatr, # Regression for weighted data,
  modelr, # Turn results of lm() into a tibble,
  modelsummary, # for balance tables,
  texreg) # regression tables with nice layout.

# 1. read the APAX data
load("../../../assets/APAX.Rdata") # Read APAX data,
APAX <- APAX %>% mutate(
  # News in minutes,
  news = news_hrs*60 + news_mins, 
  news_yn = case_when( # News Yes/No,
    news < 15 ~ 0, # Less than 15  minutes,
    news >= 15 ~ 1, # 15  minutes and more,
    TRUE ~ as.numeric(NA)),
  # Average discrimination index across domains,
  dis_index = rowmeans( #<<
    dis_trainee, dis_job, dis_school, #<<
    dis_house, dis_gov, dis_public, #<<
    na.rm = TRUE), #<<
  # Z-standardized discrimination index.
  z_dis_index = scale(dis_index) %>% 
    as.numeric())
```
`r unhide()`

2. The APAX data also contains a variable `antidiscr_law` on support for anti-discrimination policy: "How good or bad is it for a country to have a law against ethnic discrimination in the work place?". The answer categories are: (1) Very bad, (2) Bad, (3) So/so, (4) Good, (5) Very good. Make a scatter plot to see whether time spent on reading news predicts more support for anti-discrimination policies. The plot should conatain a 95% CI for the OLS line. Make sure to use weights and to express weights as size of the scattered dots. *What does the naïv analysis suggest?*

`r hide("R solution -> dont' peak to early ;) !")`
```{r}
ggplot(data = APAX, aes(y = antidiscr_law, x = news)) +
  geom_point(aes(size = gewFAKT), alpha = 1/3) +
  geom_smooth(aes(weight = gewFAKT), method = "lm") +
  scale_y_continuous(breaks = 1:5, labels = c("Very bad", "Bad", "So/so", "Good", "Very good")) +
  labs(y = "How good is a law against ethnic discrimination?", x = "Daily minutes of news consumption") +
  theme_minimal() +
  theme(legend.position = "none")
```
`r unhide()`

3. A day has only 1440 minutes. Thus some people's answers are clearly wrong. Recode all who read news more than 4 hours to 4 hours of news consumption. Then make the plot again. *What does the naïv analysis suggest?*

`r hide("R solution -> dont' peak to early ;) !")`
```{r}
APAX <- APAX %>%
  mutate(
    news = case_when(
      # 4 hours = 240 minutes.
      news > 240 ~ 240,
      TRUE ~ news))

ggplot(data = APAX, aes(y = antidiscr_law, x = news)) +
  geom_point(aes(size = gewFAKT), alpha = 1/3) +
  geom_smooth(aes(weight = gewFAKT), method = "lm") +
  scale_y_continuous(breaks = 1:5, labels = c("Very bad", "Bad", "So/so", "Good", "Very good")) +
  labs(y = "How good is a law against ethnic discrimination?", x = "Daily minutes of news consumption") +
  theme_minimal() +
  theme(legend.position = "none")
```
`r unhide()`

```{r naiv_OLS, include = FALSE}
ols <- lm_robust(antidiscr_law ~ news_yn, 
                 weight = gewFAKT, data = APAX)

screenreg(ols, include.ci = FALSE, digits = 3)
```

```{r include = FALSE}
coef <- coef(ols)["news_yn"] %>% round(., 3) %>% as.scalar()
se <- vcov(ols) %>% diag()
se <- se["news_yn"] %>% sqrt() %>% round(., 3) %>% as.scalar()
```

4. Use the binary news consumption variable and run a OLS regression. How much more or less do news readers support a law against ethnic discrimination? `r fitb(coef, width = "5")` What is the estimated standard error of this $\hat{\beta}$? `r fitb(se, width = "5")`. *What do these two statistics suggest about the naïv comparison?*
`r hide("R solution -> dont' peak to early ;) !")`
```{r ref.label="naiv_OLS"}
```
`r unhide()`