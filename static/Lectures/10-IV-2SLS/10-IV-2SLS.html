<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Multiple Regression &amp;    Fundamentals of Causal Inference</title>
    <meta charset="utf-8" />
    <meta name="author" content="Merlin Schaeffer  Department of Sociology" />
    <meta name="date" content="2025-11-18" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="../template/Merlin169.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Multiple Regression &amp; <br><br> Fundamentals of Causal Inference
]
.subtitle[
## Instrument Variables II:<br><br> Two Stage Least Squares (2SLS)
]
.author[
### Merlin Schaeffer<br> Department of Sociology
]
.date[
### 2025-11-18
]

---


# Goal of empirical sociology

.font130[.center[Use data to discover patterns, &lt;br&gt; and the .alert[social mechanisms that bring them about.]]]

&lt;img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgykJbXZbwIX-nd1oVOyzmEfj09ho8aQ4HBhfMH27t6YeTYSBevfrD2DFTEQSe7e3UwaVnv-fAJAOVpjW2pSGfG2QNrgHfkTmFtRWK4VXl6KmWK6vVlLud0DRU6lFXAqBF7iij420oOTLFh/s1600/photo.JPG" width="50%" style="display: block; margin: auto;" /&gt;


---
class: inverse middle
# Today's schedule

Application of the day: Does education pay off?
  + Recapitulation of IV.
  + Two-stage least Squares (2SLS).
  + Wald IV versus 2SLS IV Estimator.

---
class: inverse
# Application of the day

.push-left[.center[.font130[
**_Returns to education_: &lt;br&gt;&lt;br&gt;Does education really pay off?**
]]]

.push-right[
&lt;img src="https://c8.alamy.com/zooms/9/bfa9df51a3cd4e3199eaf06327d83679/e3r26y.jpg" width="65%" style="display: block; margin: auto;" /&gt;&lt;img src="https://uniavisen.dk/wp-content/uploads/2019/09/customcustomsizeimmatrikulationuniavisenheddarysstad031.jpg" width="65%" style="display: block; margin: auto;" /&gt;
]

---
# Isn't the answer obvious?

.left-column[
&lt;img src="10-IV-2SLS_files/figure-html/DAG_1-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.right-column[
&lt;img src="./img/Karlson_1.png" width="100%" style="display: block; margin: auto;" /&gt;
.backgrnote[.center[*Source:* Karlson and Landersø (2021)]]
]

---
# No, there are confounders!

.left-column[
&lt;img src="10-IV-2SLS_files/figure-html/DAG_2-1.png" width="100%" style="display: block; margin: auto;" /&gt;


]

.right-column[
&lt;img src="https://www.learnliberty.org/wp-content/uploads/2017/09/Sni%CC%81mek-obrazovky-2021-11-09-v-21.24.45.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
# We need an RCT!

.push-left[
&lt;img src="./img/randomization2.png" width="60%" style="display: block; margin: auto;" /&gt;

If we *randomly* divide subjects into treatment and control groups, .alert[they come from the same underlying population]. 
  &lt;br&gt; &lt;br&gt; `\(\rightarrow\)` They will be similar, on average, *in every way*;&lt;br&gt; **including their `\(Y_{0}\)` **!
  &lt;br&gt; &lt;br&gt; `\(\rightarrow E[Y_{0i}|D=1] = E[Y_{0i}|D=0]\)`!
]

.push-right[
&lt;img src="10-IV-2SLS_files/figure-html/DAG_RCT-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]

---
# Angrist and Krueger (1991) had an idea

.right-column[
- In the US, the school year starts 1 June.
- Kids enter school in the year in which they turn 6.
- Attending school is mandatory until one turns 16.

.center[

`\(\rightarrow\)` Dropouts born in the 4th quarter of a year, will have one more year of education compared to those born in the first one!

]

.push-left[
**Carl**: Born 1 January 1930, enters school aged 6.5 in June 1936. He drops out on the day of his 16th birthday with 9 years of schooling.
]
.push-right[
**Luis**: Born 31 December 1930, enters school aged 5.5 in June 1936. He drops out on the day of his 16th birthday with 10 years of schooling.
]

.content-box-green[
Is the quarter of birth a valid instrument for years of schooling?
]]

.left-column[.font90[
&lt;img src="10-IV-2SLS_files/figure-html/DAGIV-1.png" width="70%" style="display: block; margin: auto;" /&gt;

.content-box-red[
.center[**3 Requirements**]
1. *First stage*: Instrument `\(Z_{i}\)` has causal effect `\(\phi\)` on `\(D_{i}\)`.

2. *Randomization*: `\(Z_{i}\)` is randomly assigned (RCT or natural experiment).

3. *Exclusion restriction*: `\(Z_{i}\)` affects `\(Y_{i}\)` **_only_** through its effect on `\(D_{i}\)`.
]]]

---
# Angrist and Krueger (1991) had an idea

.right-column[
- In the US, the school year starts 1 June.
- Kids enter school in the year in which they turn 6.
- Attending school is mandatory until one turns 16.

.center[

`\(\rightarrow\)` Dropouts born in the 4th quarter of a year, will have one more year of education compared to those born in the first one!

]

.push-left[
**Carl**: Born 1 January 1930, enters school aged 6.5 in June 1936. He drops out on the day of his 16th birthday with 9 years of schooling.
]
.push-right[
**Luis**: Born 31 December 1930, enters school aged 5.5 in June 1936. He drops out on the day of his 16th birthday with 10 years of schooling.
]]

.left-column[.font90[
&lt;img src="10-IV-2SLS_files/figure-html/unnamed-chunk-6-1.png" width="504" style="display: block; margin: auto;" /&gt;

**First Stage:** `\(E[D_{i}|Z_{i}=1]-E[D_{i}|Z_{i}=0]; \text{call this }\phi.\)`

**Reduced Form:** `\(E[Y_{i}|Z_{i}=1]-E[Y_{i}|Z_{i}=0]; \text{call this }\rho.\)`

**IV Estimator:** `\(\lambda = \frac{\rho}{\phi} = \frac{E[Y_{i}|Z_{i}=1]-E[Y_{i}|Z_{i}=0]}{E[D_{i}|Z_{i}=1]-E[D_{i}|Z_{i}=0]}.\)`
]]

---
  # Replication
  
.panelset[
.panel[.panel-name[The data]
.font80[

``` r
pacman::p_load(
  tidyverse, # Data manipulation,
  ggplot2, # beautiful figures,
  modelsummary, # for balance and regression tables.
  estimatr, # Regression for weighted data,
  modelr, # Turn results of lm() into a tibble,
  ivreg, # IV 2SLS,
  masteringmetrics) # Data and examples from Mastering Metrics

# Load the data from the Quarter of Birth IV study
data("ak91", package = "masteringmetrics")
ak91 # Print forst 10 rows of the data
# # A tibble: 329,509 × 6
#      lnw     s   yob   qob   sob   age
#    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
#  1  5.79    12  1930     1    45    50
#  2  5.95    11  1930     1    45    50
#  3  5.32    12  1930     1    45    50
#  4  5.60    12  1930     1    45    50
#  5  6.07    12  1930     1    37    50
#  6  5.79    11  1930     1    45    50
#  7  6.39    11  1930     1    36    50
#  8  6.05    12  1930     1    51    50
#  9  5.35    11  1930     1    45    50
# 10  5.26     7  1930     1    45    50
# # ℹ 329,499 more rows
```
]]
.panel[.panel-name[Naïv comparison]
.push-left[.font80[

``` r
# Regress wage on years of schooling (S) and age
mult_OLS = lm_robust(lnw ~ s + age, data = ak91)
# Make a regression table
modelsummary(list("log Wage" = mult_OLS), stars = TRUE,
             gof_map = c("nobs", "r.squared"), output = "kableExtra")
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; log Wage &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 4.776*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.018) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; s &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.071*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.000) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; age &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.005*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.000) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 329509 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.118 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]
.push-right[
&lt;img src="10-IV-2SLS_files/figure-html/naiv-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]]
.panel[.panel-name[The reduced form/ITT]
.push-left[.font80[

``` r
# Reduced form
reduced_frm &lt;- lm_robust(lnw ~ qob, data = ak91)
# Regression table
modelsummary(list("log Wage" = reduced_frm), stars = TRUE,
             gof_map = c("nobs", "r.squared"), output = "kableExtra")
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; log Wage &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 5.887*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.003) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; qob &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.005*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.001) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 329509 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]
.push-right[
.push-left[
&lt;img src="10-IV-2SLS_files/figure-html/reduced1-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.push-right[
&lt;img src="10-IV-2SLS_files/figure-html/reduced2-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]]]
.panel[.panel-name[The first stage]
.push-left[.font80[

``` r
# First stage
frst_stage &lt;- lm_robust(s ~ qob, data = ak91)
# Regression table
modelsummary(list("Schooling" = frst_stage), stars = TRUE,
             gof_map = c("nobs", "r.squared"), output = "kableExtra")
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Schooling &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 12.641*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.014) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; qob &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.052*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.005) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 329509 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]
.push-right[
.push-left[
&lt;img src="10-IV-2SLS_files/figure-html/first1-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.push-right[
&lt;img src="10-IV-2SLS_files/figure-html/first2-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]]]
.panel[.panel-name[IV]
.left-column[.font80[

``` r
*iv &lt;- ivreg( # IV (2SLS)
* lnw ~ s | qob,
* data = ak91)

modelsummary(
  list("OLS" = mult_OLS, 
       "Reduced Form" = reduced_frm, 
       "1st Stage" = frst_stage, 
       "IV" = iv), stars = TRUE, 
  gof_map = c("nobs", "r.squared"),
  output = "gt")
```
`$$\text{IV} = \frac{\rho}{\phi} = \frac{0.005}{0.052} = 0.099$$`
]]
.right-column[.font90[
<div id="habkrrspuv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#habkrrspuv table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#habkrrspuv thead, #habkrrspuv tbody, #habkrrspuv tfoot, #habkrrspuv tr, #habkrrspuv td, #habkrrspuv th {
  border-style: none;
}

#habkrrspuv p {
  margin: 0;
  padding: 0;
}

#habkrrspuv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#habkrrspuv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#habkrrspuv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#habkrrspuv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#habkrrspuv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#habkrrspuv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#habkrrspuv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#habkrrspuv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#habkrrspuv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#habkrrspuv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#habkrrspuv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#habkrrspuv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#habkrrspuv .gt_spanner_row {
  border-bottom-style: hidden;
}

#habkrrspuv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#habkrrspuv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#habkrrspuv .gt_from_md > :first-child {
  margin-top: 0;
}

#habkrrspuv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#habkrrspuv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#habkrrspuv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#habkrrspuv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#habkrrspuv .gt_row_group_first td {
  border-top-width: 2px;
}

#habkrrspuv .gt_row_group_first th {
  border-top-width: 2px;
}

#habkrrspuv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#habkrrspuv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#habkrrspuv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#habkrrspuv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#habkrrspuv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#habkrrspuv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#habkrrspuv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#habkrrspuv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#habkrrspuv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#habkrrspuv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#habkrrspuv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#habkrrspuv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#habkrrspuv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#habkrrspuv .gt_left {
  text-align: left;
}

#habkrrspuv .gt_center {
  text-align: center;
}

#habkrrspuv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#habkrrspuv .gt_font_normal {
  font-weight: normal;
}

#habkrrspuv .gt_font_bold {
  font-weight: bold;
}

#habkrrspuv .gt_font_italic {
  font-style: italic;
}

#habkrrspuv .gt_super {
  font-size: 65%;
}

#habkrrspuv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#habkrrspuv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#habkrrspuv .gt_indent_1 {
  text-indent: 5px;
}

#habkrrspuv .gt_indent_2 {
  text-indent: 10px;
}

#habkrrspuv .gt_indent_3 {
  text-indent: 15px;
}

#habkrrspuv .gt_indent_4 {
  text-indent: 20px;
}

#habkrrspuv .gt_indent_5 {
  text-indent: 25px;
}

#habkrrspuv .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#habkrrspuv div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a-"> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="OLS">OLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Reduced-Form">Reduced Form</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="a1st-Stage">1st Stage</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="IV">IV</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers=" " class="gt_row gt_left">(Intercept)</td>
<td headers="OLS" class="gt_row gt_center">4.776***</td>
<td headers="Reduced Form" class="gt_row gt_center">5.887***</td>
<td headers="1st Stage" class="gt_row gt_center">12.641***</td>
<td headers="IV" class="gt_row gt_center">4.633***</td></tr>
    <tr><td headers=" " class="gt_row gt_left"></td>
<td headers="OLS" class="gt_row gt_center">(0.018)</td>
<td headers="Reduced Form" class="gt_row gt_center">(0.003)</td>
<td headers="1st Stage" class="gt_row gt_center">(0.014)</td>
<td headers="IV" class="gt_row gt_center">(0.250)</td></tr>
    <tr><td headers=" " class="gt_row gt_left">s</td>
<td headers="OLS" class="gt_row gt_center">0.071***</td>
<td headers="Reduced Form" class="gt_row gt_center"></td>
<td headers="1st Stage" class="gt_row gt_center"></td>
<td headers="IV" class="gt_row gt_center">0.099***</td></tr>
    <tr><td headers=" " class="gt_row gt_left"></td>
<td headers="OLS" class="gt_row gt_center">(0.000)</td>
<td headers="Reduced Form" class="gt_row gt_center"></td>
<td headers="1st Stage" class="gt_row gt_center"></td>
<td headers="IV" class="gt_row gt_center">(0.020)</td></tr>
    <tr><td headers=" " class="gt_row gt_left">age</td>
<td headers="OLS" class="gt_row gt_center">0.005***</td>
<td headers="Reduced Form" class="gt_row gt_center"></td>
<td headers="1st Stage" class="gt_row gt_center"></td>
<td headers="IV" class="gt_row gt_center"></td></tr>
    <tr><td headers=" " class="gt_row gt_left"></td>
<td headers="OLS" class="gt_row gt_center">(0.000)</td>
<td headers="Reduced Form" class="gt_row gt_center"></td>
<td headers="1st Stage" class="gt_row gt_center"></td>
<td headers="IV" class="gt_row gt_center"></td></tr>
    <tr><td headers=" " class="gt_row gt_left">qob</td>
<td headers="OLS" class="gt_row gt_center"></td>
<td headers="Reduced Form" class="gt_row gt_center">0.005***</td>
<td headers="1st Stage" class="gt_row gt_center">0.052***</td>
<td headers="IV" class="gt_row gt_center"></td></tr>
    <tr><td headers=" " class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="OLS" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Reduced Form" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">(0.001)</td>
<td headers="1st Stage" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">(0.005)</td>
<td headers="IV" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td></tr>
    <tr><td headers=" " class="gt_row gt_left">Num.Obs.</td>
<td headers="OLS" class="gt_row gt_center">329509</td>
<td headers="Reduced Form" class="gt_row gt_center">329509</td>
<td headers="1st Stage" class="gt_row gt_center">329509</td>
<td headers="IV" class="gt_row gt_center">329509</td></tr>
    <tr><td headers=" " class="gt_row gt_left">R2</td>
<td headers="OLS" class="gt_row gt_center">0.118</td>
<td headers="Reduced Form" class="gt_row gt_center">0.000</td>
<td headers="1st Stage" class="gt_row gt_center">0.000</td>
<td headers="IV" class="gt_row gt_center">0.098</td></tr>
  </tbody>
  <tfoot>
    <tr class="gt_sourcenotes">
      <td class="gt_sourcenote" colspan="5">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
    </tr>
  </tfoot>
</table>
</div>
]]]]

---
class: inverse middle center

# Two-Stage Least Squares (2SLS)

The Frisch-Waugh perspective on IV

---
# The *first* stage
  
  .left-column[
&lt;img src="10-IV-2SLS_files/figure-html/unnamed-chunk-12-1.png" width="100%" style="display: block; margin: auto;" /&gt;
    
&lt;img src="10-IV-2SLS_files/figure-html/unnamed-chunk-13-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.right-column[

``` r
frst_stage &lt;- lm_robust(s ~ qob, data = ak91) # The first stage
  
(ak91 &lt;- ak91 %&gt;% # Add predictions and residuals
      add_predictions(frst_stage, data = .) %&gt;%
      add_residuals(frst_stage, data = .) %&gt;%
      rename(pred_s = pred, e_s = resid))
# # A tibble: 329,509 × 8
#      lnw     s   yob   qob   sob   age pred_s    e_s
#    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
#  1  5.79    12  1930     1    45    50   12.7 -0.692
#  2  5.95    11  1930     1    45    50   12.7 -1.69 
#  3  5.32    12  1930     1    45    50   12.7 -0.692
#  4  5.60    12  1930     1    45    50   12.7 -0.692
#  5  6.07    12  1930     1    37    50   12.7 -0.692
#  6  5.79    11  1930     1    45    50   12.7 -1.69 
#  7  6.39    11  1930     1    36    50   12.7 -1.69 
#  8  6.05    12  1930     1    51    50   12.7 -0.692
#  9  5.35    11  1930     1    45    50   12.7 -1.69 
# 10  5.26     7  1930     1    45    50   12.7 -5.69 
# # ℹ 329,499 more rows
```
  
.content-box-green[.font80[
Which is unconfounded, the predicted education `pred_s` or the residuals `e_s`?
]]]

---
# The *second* stage
  
.push-left[
&lt;img src="10-IV-2SLS_files/figure-html/unnamed-chunk-15-1.png" width="50%" style="display: block; margin: auto;" /&gt;
    
- An instrument `\(Z_{i}\)` induces random variation into the treatment `\(D_{i}\)`. 
- We can isolate that random variation, by taking the predictions `\(\hat{D}_{i}\)` from the **first stage**:
      `$$D_{i} = \alpha_1 + \phi Z_{i} + e_{i}.$$`
- We then use `\(\hat{D}_{i}\)` as predictor in the **second stage**:
      `$$Y_{i} = \alpha_2 + \lambda_{\text{2SLS}}\hat{D}_{i} + e_{i}.$$`
]

.push-right[.font80[

``` r
scnd_stage &lt;- lm_robust(lnw ~ pred_s, data = ak91) # Second stage
*iv &lt;- ivreg(lnw ~ s | qob, data = ak91) # IV (2SLS)

modelsummary(list("2n Stage" = scnd_stage, 
                    "IV" = iv), stars = TRUE, 
               gof_map = c("nobs", "r.squared"),
               output = "gt")
```

<div id="tebsinimvt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#tebsinimvt table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#tebsinimvt thead, #tebsinimvt tbody, #tebsinimvt tfoot, #tebsinimvt tr, #tebsinimvt td, #tebsinimvt th {
  border-style: none;
}

#tebsinimvt p {
  margin: 0;
  padding: 0;
}

#tebsinimvt .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tebsinimvt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#tebsinimvt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tebsinimvt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tebsinimvt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tebsinimvt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tebsinimvt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tebsinimvt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tebsinimvt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tebsinimvt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tebsinimvt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tebsinimvt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tebsinimvt .gt_spanner_row {
  border-bottom-style: hidden;
}

#tebsinimvt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#tebsinimvt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tebsinimvt .gt_from_md > :first-child {
  margin-top: 0;
}

#tebsinimvt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tebsinimvt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tebsinimvt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#tebsinimvt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#tebsinimvt .gt_row_group_first td {
  border-top-width: 2px;
}

#tebsinimvt .gt_row_group_first th {
  border-top-width: 2px;
}

#tebsinimvt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tebsinimvt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#tebsinimvt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#tebsinimvt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tebsinimvt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tebsinimvt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tebsinimvt .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#tebsinimvt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tebsinimvt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tebsinimvt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tebsinimvt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tebsinimvt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tebsinimvt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tebsinimvt .gt_left {
  text-align: left;
}

#tebsinimvt .gt_center {
  text-align: center;
}

#tebsinimvt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tebsinimvt .gt_font_normal {
  font-weight: normal;
}

#tebsinimvt .gt_font_bold {
  font-weight: bold;
}

#tebsinimvt .gt_font_italic {
  font-style: italic;
}

#tebsinimvt .gt_super {
  font-size: 65%;
}

#tebsinimvt .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#tebsinimvt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#tebsinimvt .gt_indent_1 {
  text-indent: 5px;
}

#tebsinimvt .gt_indent_2 {
  text-indent: 10px;
}

#tebsinimvt .gt_indent_3 {
  text-indent: 15px;
}

#tebsinimvt .gt_indent_4 {
  text-indent: 20px;
}

#tebsinimvt .gt_indent_5 {
  text-indent: 25px;
}

#tebsinimvt .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#tebsinimvt div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a-"> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="a2n-Stage">2n Stage</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="IV">IV</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers=" " class="gt_row gt_left">(Intercept)</td>
<td headers="2n Stage" class="gt_row gt_center">4.633***</td>
<td headers="IV" class="gt_row gt_center">4.633***</td></tr>
    <tr><td headers=" " class="gt_row gt_left"></td>
<td headers="2n Stage" class="gt_row gt_center">(0.263)</td>
<td headers="IV" class="gt_row gt_center">(0.250)</td></tr>
    <tr><td headers=" " class="gt_row gt_left">pred_s</td>
<td headers="2n Stage" class="gt_row gt_center">0.099***</td>
<td headers="IV" class="gt_row gt_center"></td></tr>
    <tr><td headers=" " class="gt_row gt_left"></td>
<td headers="2n Stage" class="gt_row gt_center">(0.021)</td>
<td headers="IV" class="gt_row gt_center"></td></tr>
    <tr><td headers=" " class="gt_row gt_left">s</td>
<td headers="2n Stage" class="gt_row gt_center"></td>
<td headers="IV" class="gt_row gt_center">0.099***</td></tr>
    <tr><td headers=" " class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="2n Stage" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="IV" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">(0.020)</td></tr>
    <tr><td headers=" " class="gt_row gt_left">Num.Obs.</td>
<td headers="2n Stage" class="gt_row gt_center">329509</td>
<td headers="IV" class="gt_row gt_center">329509</td></tr>
    <tr><td headers=" " class="gt_row gt_left">R2</td>
<td headers="2n Stage" class="gt_row gt_center">0.000</td>
<td headers="IV" class="gt_row gt_center">0.098</td></tr>
  </tbody>
  <tfoot>
    <tr class="gt_sourcenotes">
      <td class="gt_sourcenote" colspan="3">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
    </tr>
  </tfoot>
</table>
</div>
]]

---
class: inverse middle center
# Break

&lt;iframe src='https://panel.letstimeit.com/instant-timer/15-minute' width='600' height='400' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;

---
class: middle clear

.left-column[
&lt;img src="https://cdn.dribbble.com/users/10549/screenshots/9916149/media/a9dbfea8e23e5b8e23db142528c3bc9f.png?compress=1&amp;resize=1200x900&amp;vertical=top" width="100%" style="display: block; margin: auto;" /&gt;

&lt;iframe src='https://panel.letstimeit.com/instant-timer/20-minute' width='600' height='400' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;

]

.right-column[
&lt;br&gt;
&lt;iframe src='exercise1.html' width='1000' height='600' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;
]

---
class: inverse middle center
# Break

&lt;iframe src='https://panel.letstimeit.com/instant-timer/10-minute' width='600' height='400' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;


---
# Two perspectives on IV
  
&lt;img src="10-IV-2SLS_files/figure-html/DAG_IV-1.png" width="25%" style="display: block; margin: auto;" /&gt;

.push-left[
.content-box-blue[
.center[**Wald IV estimator**]
    
`$$\lambda_{\text{Wald}} = \frac{\rho}{\phi}$$`
      *Conceptually*: Weigh up the ITT (or `\(\rho\)` ) on `\(Y\)` to get the causal effect of `\(D\)` among complyers.
]]

.push-right[
.content-box-green[
.center[**2SLS IV estimator**]
    
`$$Y_{i} = \alpha + \lambda_{\text{2SLS}}\hat{D}_{i} + e_{i}$$`
      *Conceptually*: Use (first stage) OLS to isolate random variation in `\(D\)`. Use that random variation in a second (stage) OLS to estimate the causal effect of `\(D\)` on `\(Y\)` among complyers.
    
*Advantage*: We can use several instruments to identify as much random variation in `\(D\)` as possible!
]]

---
# Control vs. instrument variables
  
.push-right[.content-box-blue[
&lt;img src="10-IV-2SLS_files/figure-html/unnamed-chunk-18-1.png" width="50%" style="display: block; margin: auto;" /&gt;
    
An instrument variable `\(Z\)` induces random variation into `\(D\)`. 
    
By using IV, we only keep the predicted values (not the resuduals) of `\(D\)`, the part of `\(D\)` that **_correlates_** with `\(Z\)`.
]]

.push-left[.content-box-red[
  &lt;img src="10-IV-2SLS_files/figure-html/DAG_FrischWaugh-1.png" width="29%" style="display: block; margin: auto;" /&gt;
  
A confounder `\(C\)` induces bias into `\(D\)`. 
  
By controlling for `\(C\)`, we only keep the residuals (not the predicted values) of `\(D\)`, the part of `\(D\)` that **_does not correlate_** with `\(C\)`.
]]

---
# Remember the exclusion restriction!
  
.left-column[
&lt;img src="10-IV-2SLS_files/figure-html/DAG_5-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.right-column[
&lt;img src="./img/Buckles1.png" width="100%" style="display: block; margin: auto;" /&gt;
.backgrnote[.center[*Source:* Buckles and Hungerman (2013)]]
]

---
# Remember the exclusion restriction!
  
.left-column[
&lt;img src="10-IV-2SLS_files/figure-html/unnamed-chunk-20-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.right-column[
&lt;img src="./img/Buckles2.png" width="100%" style="display: block; margin: auto;" /&gt;
.backgrnote[.center[*Source:* Buckles and Hungerman (2013)]]
]

---
# Remember the exclusion restriction!
.content-box-blue[
&lt;img src="10-IV-2SLS_files/figure-html/DAG_IV2-1.png" width="25%" style="display: block; margin: auto;" /&gt;
    
If the exclusion restriction does not hold, an instrument basically turns into a confounder. This has two implications:
      
1. The instrument does not induce random variation but bias into `\(D\)`. Remember, a backdoor path is any path from `\(D\)` to `\(Y\)` that starts with an arrow into `\(D\)`.
    
2. We learned from the Wald-IV perspective: By using IV, we weigh up it's bias by `\(\frac{1}{\phi}\)`!
]

---

&lt;!-- --- --&gt;
&lt;!-- layout: false --&gt;
&lt;!-- class: inverse middle center --&gt;
&lt;!-- # Does state surveillance spark resistance? --&gt;

&lt;!-- &lt;iframe width="560" height="315" src="https://www.youtube.com/embed/YsShZNHmpGE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen&gt;&lt;/iframe&gt; --&gt;

&lt;!-- --- --&gt;
&lt;!-- layout: true --&gt;
&lt;!-- # The end of communism in Poland --&gt;

&lt;!-- --- --&gt;

&lt;!-- .left-column[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='85%'} --&gt;
&lt;!-- knitr::include_graphics('https://dzieje.pl/sites/default/files/styles/open_article_750x0_/public/201204/solidarnosc_tkk2.jpg?itok=YpPQeO8f') --&gt;
&lt;!-- knitr::include_graphics('https://edupolis.pl/wp-content/uploads/2021/05/Solidarnosc.jpg') --&gt;
&lt;!-- ``` --&gt;


&lt;!-- ] --&gt;

&lt;!-- .right-column[.font80[ --&gt;
&lt;!-- &gt; Following World War II, in 1947 the Soviet Union imposed a Marxist–Leninist government in Poland, called the Polish People’s Republic (henceforth, PPR). [...]  --&gt;


&lt;!-- &gt; By the early 1980s, protests organized by workers of state firms led to the creation of the Independent and Self-Governing Trade Union Solidarity (henceforth, Solidarność), the first independent trade union in Communist Poland. Solidarność created a broad, nonviolent, anticommunist social movement. The following years saw bitter fights, and the PPR was ultimately forced to hold (semi-)free elections in 1989. --&gt;

&lt;!-- &gt; Hager and Krakowski (2022, page 567) --&gt;
&lt;!-- ]] --&gt;
&lt;!-- --- --&gt;

&lt;!-- .left-column[ --&gt;
&lt;!-- ```{tikz, DAG_Hager, echo = FALSE, out.width='80%'} --&gt;
&lt;!-- \usetikzlibrary{shapes,decorations,arrows,calc,arrows.meta,fit,positioning,quotes} --&gt;
&lt;!-- \tikzset{ --&gt;
&lt;!--   -Latex,auto,node distance =1 cm and 1 cm,semithick, --&gt;
&lt;!--   state/.style ={ellipse, draw, minimum width = 0.7 cm}, --&gt;
&lt;!--   point/.style = {circle, draw, inner sep=0.04cm,fill,node contents={}}, --&gt;
&lt;!--   bidirected/.style={Latex-Latex,dashed}, --&gt;
&lt;!--   el/.style = {inner sep=2pt, align=left, sloped} --&gt;
&lt;!-- } --&gt;

&lt;!-- \begin{tikzpicture} --&gt;
&lt;!-- \sffamily --&gt;
&lt;!-- \node[state, align = center] (1) at (0,0) {Surveillance}; --&gt;
&lt;!-- \node[state, align = center] (2) [right = of 1] {Resistance}; --&gt;

&lt;!-- \path (1) edge (2); --&gt;
&lt;!-- \end{tikzpicture} --&gt;
&lt;!-- ``` --&gt;

&lt;!-- ```{r, echo = FALSE, out.width='85%'} --&gt;
&lt;!-- knitr::include_graphics('https://dzieje.pl/sites/default/files/styles/open_article_750x0_/public/201204/solidarnosc_tkk2.jpg?itok=YpPQeO8f') --&gt;
&lt;!-- knitr::include_graphics('https://edupolis.pl/wp-content/uploads/2021/05/Solidarnosc.jpg') --&gt;
&lt;!-- ``` --&gt;
&lt;!-- ] --&gt;

&lt;!-- .right-column[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='40%'} --&gt;
&lt;!-- knitr::include_graphics('https://static.cambridge.org/binary/version/id/urn:cambridge.org:id:binary:20220425072255995-0362:S0003055421000770:S0003055421000770_fig1.png') --&gt;
&lt;!-- ``` --&gt;

&lt;!-- .font70[ --&gt;
&lt;!-- &gt; To obtain these data, we digitized archival sources from the Institute of National Remembrance (IPN, Polish acronym), which lists all secret police officers who operated in the region. [...] The resulting variable, *Surveillance*, indicates the number of officers per year and municipality from 1945 to 1989.  --&gt;

&lt;!-- &gt; Hager and Krakowski (2022, page 567) --&gt;
&lt;!-- ]] --&gt;

&lt;!-- --- --&gt;

&lt;!-- .left-column[ --&gt;
&lt;!-- ```{tikz, ref.label = "DAG_Hager", echo = FALSE, out.width='80%'} --&gt;

&lt;!-- ``` --&gt;

&lt;!-- ```{r, echo = FALSE, out.width='85%'} --&gt;
&lt;!-- knitr::include_graphics('https://dzieje.pl/sites/default/files/styles/open_article_750x0_/public/201204/solidarnosc_tkk2.jpg?itok=YpPQeO8f') --&gt;
&lt;!-- knitr::include_graphics('https://edupolis.pl/wp-content/uploads/2021/05/Solidarnosc.jpg') --&gt;
&lt;!-- ``` --&gt;
&lt;!-- ] --&gt;

&lt;!-- .right-column[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='40%'} --&gt;
&lt;!-- knitr::include_graphics('https://static.cambridge.org/binary/version/id/urn:cambridge.org:id:binary-alt:20220425072512-79013-optimisedImage-S0003055421000770_fig2.jpg') --&gt;
&lt;!-- ``` --&gt;

&lt;!-- .font70[ --&gt;
&lt;!-- &gt; We measure antiregime protests by geocoding all Solidarność strikes from 1980 to 1986 (Table A.1). Four reasons make the strikes a particularly relevant outcome. First and most important, Solidarność ultimately led to the toppling of the PPR. [...] To measure Solidarność strikes, we consulted archival sources by Niezależny Samorządny Zwiazek Zawodowy (NSZZ) Solidarność 1980–1989. --&gt;

&lt;!-- &gt; Hager and Krakowski (2022, page 568) --&gt;

&lt;!-- ]] --&gt;

&lt;!-- --- --&gt;

&lt;!-- .left-column[ --&gt;
&lt;!-- ```{tikz, ref.label = "DAG_Hager", echo = FALSE, out.width='80%'} --&gt;

&lt;!-- ``` --&gt;

&lt;!-- ```{r, echo = FALSE, out.width='85%'} --&gt;
&lt;!-- knitr::include_graphics('https://dzieje.pl/sites/default/files/styles/open_article_750x0_/public/201204/solidarnosc_tkk2.jpg?itok=YpPQeO8f') --&gt;
&lt;!-- knitr::include_graphics('https://edupolis.pl/wp-content/uploads/2021/05/Solidarnosc.jpg') --&gt;
&lt;!-- ``` --&gt;
&lt;!-- ] --&gt;

&lt;!-- .right-column[ --&gt;
&lt;!-- .center[Multiple OLS] --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='100%'} --&gt;
&lt;!-- knitr::include_graphics('./img/Hager1.png') --&gt;
&lt;!-- ``` --&gt;
&lt;!-- ] --&gt;

&lt;!-- --- --&gt;

&lt;!-- .left-column[ --&gt;
&lt;!-- ```{tikz, DAG_Hager2, echo = FALSE, out.width='80%'} --&gt;
&lt;!-- \usetikzlibrary{shapes,decorations,arrows,calc,arrows.meta,fit,positioning,quotes} --&gt;
&lt;!-- \tikzset{ --&gt;
&lt;!--   -Latex,auto,node distance =1 cm and 1 cm,semithick, --&gt;
&lt;!--   state/.style ={ellipse, draw, minimum width = 0.7 cm}, --&gt;
&lt;!--   point/.style = {circle, draw, inner sep=0.04cm,fill,node contents={}}, --&gt;
&lt;!--   bidirected/.style={Latex-Latex,dashed}, --&gt;
&lt;!--   el/.style = {inner sep=2pt, align=left, sloped} --&gt;
&lt;!-- } --&gt;

&lt;!-- \begin{tikzpicture} --&gt;
&lt;!-- \sffamily --&gt;
&lt;!-- \node[state, align = center] (1) at (0,0) {Surveillance}; --&gt;
&lt;!-- \node[state, align = center] (2) [right = of 1] {Resistance}; --&gt;
&lt;!-- \node[state, align = center] (3) [red, dashed, above = of 1] {$C?$}; --&gt;

&lt;!-- \path (1) edge (2); --&gt;
&lt;!-- \path (3) edge [red, dashed] (1); --&gt;
&lt;!-- \path (3) edge [red, dashed] (2); --&gt;
&lt;!-- \end{tikzpicture} --&gt;
&lt;!-- ``` --&gt;

&lt;!-- ```{r, echo = FALSE, out.width='70%'} --&gt;
&lt;!-- knitr::include_graphics('https://dzieje.pl/sites/default/files/styles/open_article_750x0_/public/201204/solidarnosc_tkk2.jpg?itok=YpPQeO8f') --&gt;
&lt;!-- knitr::include_graphics('https://edupolis.pl/wp-content/uploads/2021/05/Solidarnosc.jpg') --&gt;
&lt;!-- ``` --&gt;

&lt;!-- .content-box-green[ --&gt;
&lt;!-- Why might these results not be causal? --&gt;
&lt;!-- ] --&gt;
&lt;!-- ] --&gt;

&lt;!-- .right-column[ --&gt;
&lt;!-- .center[Multiple OLS] --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='100%'} --&gt;
&lt;!-- knitr::include_graphics('./img/Hager1.png') --&gt;
&lt;!-- ``` --&gt;
&lt;!-- ] --&gt;

&lt;!-- --- --&gt;

&lt;!-- .left-column[ --&gt;
&lt;!-- ```{tikz, ref.label = "DAG_Hager2", echo = FALSE, out.width='80%'} --&gt;

&lt;!-- ``` --&gt;

&lt;!-- ```{r, echo = FALSE, out.width='70%'} --&gt;
&lt;!-- knitr::include_graphics('https://dzieje.pl/sites/default/files/styles/open_article_750x0_/public/201204/solidarnosc_tkk2.jpg?itok=YpPQeO8f') --&gt;
&lt;!-- knitr::include_graphics('https://edupolis.pl/wp-content/uploads/2021/05/Solidarnosc.jpg') --&gt;
&lt;!-- ``` --&gt;

&lt;!-- .content-box-green[ --&gt;
&lt;!-- Why might these results not be causal? --&gt;
&lt;!-- ] --&gt;
&lt;!-- ] --&gt;

&lt;!-- .right-column[ --&gt;
&lt;!-- .center[Multiple OLS] --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='23%'} --&gt;
&lt;!-- knitr::include_graphics('./img/Hager3.png') --&gt;
&lt;!-- ``` --&gt;
&lt;!-- ] --&gt;

&lt;!-- --- --&gt;
&lt;!-- layout: true --&gt;
&lt;!-- class: clear --&gt;
&lt;!-- # Hager and Krakowski (2022) had an idea --&gt;

&lt;!-- --- --&gt;

&lt;!-- .push-left[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='60%'} --&gt;
&lt;!-- knitr::include_graphics('https://images.fineartamerica.com/images/artworkimages/mediumlarge/2/the-confession-1838-detail-giuseppe-molteni.jpg') --&gt;
&lt;!-- ``` --&gt;

&lt;!-- .font70[ --&gt;
&lt;!-- &gt; Beginning in 1946, the Polish People’s Republic made a concerted effort to turn Catholic priests into agents of the secret police. [...]  --&gt;

&lt;!-- &gt; Important for our case, corrupted priests were crucial in the regime’s attempt to recruit additional spies and agents. The priests used confessions to collect compromising information on parishioners (Żurek Reference Żurek2009, 22, 66, 68). --&gt;

&lt;!-- &gt; Hager and Krakowski (2022, page 571) --&gt;

&lt;!-- ]] --&gt;

&lt;!-- --- --&gt;

&lt;!-- .left-column[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='100%'} --&gt;
&lt;!-- knitr::include_graphics('https://images.fineartamerica.com/images/artworkimages/mediumlarge/2/the-confession-1838-detail-giuseppe-molteni.jpg') --&gt;
&lt;!-- ``` --&gt;

&lt;!-- .font70[ --&gt;
&lt;!-- &gt; Important for our case, corrupted priests were crucial in the regime’s attempt to recruit additional spies and agents. --&gt;

&lt;!-- &gt; Hager and Krakowski (2022, page 571) --&gt;

&lt;!-- ]] --&gt;

&lt;!-- .right-column[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='100%'} --&gt;
&lt;!-- knitr::include_graphics('./img/Hager2.png') --&gt;
&lt;!-- ``` --&gt;

&lt;!-- .font70[ --&gt;
&lt;!-- &gt; we exploit the fact that the placement of Catholic priests—who were then turned into spies—is arguably exogenous. To use corrupted priests as an instrumental variable for surveillance, we must invoke five assumptions. Below, we focus on two particularly important assumptions: exogeneity and excludability. --&gt;

&lt;!-- &gt; Hager and Krakowski (2022, page 571) --&gt;
&lt;!-- ]] --&gt;

&lt;!-- --- --&gt;

&lt;!-- .right-column[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='100%'} --&gt;
&lt;!-- knitr::include_graphics('./img/Hager2.png') --&gt;
&lt;!-- ``` --&gt;

&lt;!-- .font70[ --&gt;
&lt;!-- &gt; we exploit the fact that the placement of Catholic priests—who were then turned into spies—is arguably exogenous. To use corrupted priests as an instrumental variable for surveillance, we must invoke five assumptions. Below, we focus on two particularly important assumptions: exogeneity and excludability. --&gt;

&lt;!-- &gt; Hager and Krakowski (2022, page 571) --&gt;
&lt;!-- ]] --&gt;

&lt;!-- .left-column[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='70%'} --&gt;
&lt;!-- knitr::include_graphics('https://static.cambridge.org/binary/version/id/urn:cambridge.org:id:binary-alt:20220425072512-26492-optimisedImage-S0003055421000770_tab2.jpg') --&gt;
&lt;!-- ``` --&gt;
&lt;!-- ] --&gt;

&lt;!-- --- --&gt;

&lt;!-- .push-right[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='100%'} --&gt;
&lt;!-- knitr::include_graphics('./img/Hager2.png') --&gt;
&lt;!-- ``` --&gt;
&lt;!-- .font70[ --&gt;
&lt;!-- &gt; Important for our case, corrupted priests were crucial in the regime’s attempt to recruit additional spies and agents. --&gt;

&lt;!-- &gt; Hager and Krakowski (2022, page 571) --&gt;
&lt;!-- ]] --&gt;

&lt;!-- .push-left[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='100%'} --&gt;
&lt;!-- knitr::include_graphics('./img/Hager4.png') --&gt;
&lt;!-- ``` --&gt;

&lt;!-- ] --&gt;

&lt;!-- --- --&gt;

&lt;!-- .push-right[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='100%'} --&gt;
&lt;!-- knitr::include_graphics('./img/Hager2.png') --&gt;
&lt;!-- ``` --&gt;
&lt;!-- ] --&gt;

&lt;!-- .push-left[ --&gt;
&lt;!-- ```{r, echo = FALSE, out.width='90%'} --&gt;
&lt;!-- knitr::include_graphics('./img/Hager5.png') --&gt;
&lt;!-- ``` --&gt;
&lt;!-- ] --&gt;

---
layout: false
class: inverse
# Today's general lessons 1

Two-stage least squares (2SLS)

1. 2SLS is a statistical technique that can be used to estimate the causal effect of a treatment variable on an outcome variable, even if the treatment variable and outcome variable are correlated.

2. 2SLS works by first predicting the treatment variable using an instrument variable. An instrument variable is a variable that is correlated with the treatment variable but not with the outcome variable, except through the treatment variable. Once the treatment variable has been predicted, 2SLS uses the predicted treatment variable to predict the outcome variable. The estimated causal effect of the treatment variable on the outcome variable is the coefficient on the predicted treatment variable in the second stage regression.

---
# Today's general lessons 2
  
Instrument variables vs. control variables: are both used to reduce bias in statistical models. However, they work in different ways.

1. An *instrument variable* is used to identify and control for unconfounded random variation in the treatment variable. 

2. A *control variable* is used to control for systematically confounded variation in the treatment variable.

| Characteristic | Instrument variable | Control variable |
|---|---|---|
| Purpose | To identify unconfounded random variation in the treatment variable. | To control for systematically confounded variation in the treatment variable. |
| Correlation with treatment variable | Causes treatment variable. | Causes treatment variable. |
| Correlation with outcome variable | Must be uncorrelated with outcome variable, except through the treatment variable. | Causes outcome variable. |
  
---
class: inverse
# Today's general lessons 3

The exclusion restriction

1. The exclusion restriction is a key assumption that must be met for 2SLS to produce unbiased estimates of the causal effect of the treatment variable on the outcome variable. The exclusion restriction states that the instrument variable is only correlated with the outcome variable through the treatment variable.

2. If the exclusion restriction does not hold, then 2SLS estimates will be biased. In particular, the instrument variable will basically turn into a confounder.

---
class: inverse
# Today's (important) functions

1. `ivreg()`: Estimate 2SLS regression.

---
# References
  
.font80[
Angrist, J. D. and A. B. Krueger (1991). "Does Compulsory School Attendance Affect Schooling and
Earnings?*". In: _The Quarterly Journal of Economics_, pp. 979-1014.

Buckles, K. S. and D. M. Hungerman (2013). "Season of Birth and Later Outcomes: Old Questions, New
Answers". In: _The Review of Economics and Statistics_, pp. 711-724.

Hager, A. and K. Krakowski (2022). "Does State Repression Spark Protests? Evidence from Secret Police
Surveillance in Communist Poland". In: _American Political Science Review_, pp. 564-579.

Karlson, K. and R. Landersø (2021). "The Making and Unmaking of Opportunity: Educational Mobility in
20th Century-Denmark". In: _SSRN Electronic Journal_.
]

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../template/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
  "highlightLanguage": "r",
  "highlightStyle": "zenburn",
  "highlightLines": true,
  "countIncrementalSlides": false,
  "ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
