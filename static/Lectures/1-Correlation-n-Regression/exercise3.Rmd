---
title: "Exercise 3 (10 minutes)"
subtitle: "When you're done, assist some of the others ..."
output: webexercises::webexercises_default
---

```{r setup, include = FALSE}
options(htmltools.dir.version = FALSE, servr.interval = 0.5, width = 115, digits = 2)
knitr::opts_chunk$set(
  collapse = TRUE, message = FALSE, 
  warning = FALSE, cache = FALSE,
  comment = "#", strip.white = TRUE)

library(webexercises)

pacman::p_load(
  tidyverse, # Data manipulation,
  ggplot2, # beautiful figures,
  democracyData, # download democracy datasets used in the scholarly literature.
  wbstats, # download data from Worldbank. Tremendous source of global socio-economic data.
  texreg, # regression tables with nice layout,
  countrycode) # Easy recodings of country names.

# 1. Download Freedom House data for all countries since 1972,
Dat_citi_rights <- download_fh(verbose = FALSE) %>% 
   rename(country = fh_country, # rename country ID,
          citizen_rights = fh_total_reversed, # rename Citizenship rights indicator,
          date = year) %>% # rename year,
   select(country, date, citizen_rights) # Keep only these 3 variables.

# 2. Download poverty data: <5.50$ per day
Dat_poverty <- wb_data("SI.POV.UMIC", 
                        start_date = 2011, end_date = 2022) %>% #<<
   rename(poverty = SI.POV.UMIC) %>% # rename poverty variable,
   select(country, date, poverty) %>% # Keep only 3 variables
   drop_na(poverty) %>% # Drop cases with missing data,
   group_by(country) %>% # Group by country,
   filter(date == max(date)) %>% # Keep the most recent data per country.
   ungroup()

# 3. Join Freedom House and Worldbank data
Dat <- inner_join(Dat_poverty, Dat_citi_rights, by = c("country", "date"))

# 4. Code socialism index
Dat <- Dat %>% mutate(socialist = case_when( # Years socialist minus years since,
  country == "China" ~ date - 1949,
  country == "Vietnam" ~ date - 1945,
  country == "Albania" ~ (1992 - 1944) - (date - 1992),
  grepl(country,"Belarus|Bulgaria") ~ (1990 - 1946) - (date - 1990),
  grepl(country, "Benin|Mozambique") ~ (1990 - 1975) - (date - 1990),
  country == "Congo, Rep." ~ (1992 - 1970) - (date - 1992),
  country == "Czech Republic" ~ (1990 - 1948) - (date - 1990),
  country == "Ethiopia" ~ (1991 - 1974) - (date - 1991),
  country == "Hungary" ~ (1989 - 1949) - (date - 1989),
  country == "Mongolia" ~ (1992 - 1924) - (date - 1992),
  country == "Poland" ~ (1989 - 1945) - (date - 1989),
  country == "Romania" ~ (1989 - 1947) - (date - 1989),
  country == "Russian Federation" ~ (1991 - 1922) - (date - 1991),
  country == "Somalia" ~ (1991 - 1969) - (date - 1991),
  country == "Ukraine" ~ (1991 - 1919) - (date - 1991),
  country == "Yemen, Rep." ~ (1991 - 1967) - (date - 1991),
  grepl(country,"Slovenia|Croatia|Serbia|Montenegro|Bosnia and Herzegovina|North Macedonia|Kosovo") ~ (1992 - 1943) - (date - 1992),
  grepl(country, "Cabo Verde|Madagascar|Angola") ~ (1992 - 1975) - (date - 1992),
  country == "Egypt, Arab Rep." ~ (2007 - 1953) - (date - 2007),
  country == "Iraq" ~ (2005 - 1958) - (date - 2005),
  country == "Mali" ~ (1991 - 1960) - (date - 1991),
  country == "Seychelles" ~ (1991 - 1977) - (date - 1991),
  country == "Sierra Leone" ~ (1991 - 1978) - (date - 1991),
  country == "Syria" ~ (2012 - 1963) - (date - 2012),
  country == "Tunisia" ~ (1988 - 1964) - (date - 1988),
  country == "Zambia" ~ (1991 - 1973) - (date - 1991),
  TRUE ~ 0),
  socialist = case_when( # Min. 5 years given socialist history,
    (socialist < 5 & socialist > 0) | socialist < 0 ~ 5,
    TRUE ~ socialist)) %>%
  drop_na() # Drop countries with missing values.
```

1. Is the relationship between poverty and citizenship rights driven by outliers? 
`r mcq(c("Clearly not!", "Yes! a single case drives it", "Yes, three cases are problematic", answer = "By and large not, but three cases might merit a closer look"))`
`r hide("R solution -> dont' peak to early ;) !")`
```{r out.width='80%', fig.height = 4, fig.width = 5, results = FALSE}
ols_1 <- lm(data = Dat, formula = poverty ~ citizen_rights)
plot(ols_1, which = 5) # The best outlier plot.
```
`r unhide()`

```{r echo = FALSE}
ols <- lm(data = Dat, formula = citizen_rights ~ socialist)
```
2. Is the relationship between poverty and citizenship rights approximately linear?
`r mcq(c("No, its clearly curv-linear!", answer = "There is a slight tendency for non-linearity", "Yes, perfectly straight"))`

`r hide("R solution -> dont' peak to early ;) !")`
```{r out.width='80%', fig.height = 4, fig.width = 5, results = FALSE}
plot(ols_1, which = 1) # The best outlier plot.
```
`r unhide()`