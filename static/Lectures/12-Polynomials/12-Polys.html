<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Polynomials and transformations</title>
    <meta charset="utf-8" />
    <meta name="author" content="Merlin Schaeffer  Department of Sociology" />
    <meta name="date" content="2023-12-04" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="../template/Merlin169.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Polynomials and transformations
]
.subtitle[
## Modeling non-linear relationships
]
.author[
### Merlin Schaeffer<br> Department of Sociology
]
.date[
### 2023-12-04
]

---


# Goal of empirical sociology

.font130[.center[Use data to .alert[discover patterns], &lt;br&gt; and the social mechanisms that bring them about.]]

&lt;img src="https://liu.se/-/media/istock-501261958.jpg?mw=1120&amp;mh=1120&amp;hash=DA8977CCE6A6E600AE80A40CFEE771C9" width="70%" style="display: block; margin: auto;" /&gt;

---
class: inverse middle
# Today's schedule

Application of the day: Life expectancy at birth!
1. Recap: Interaction terms.
2. LOESS (locally estimated scatterplot smoothing)
3. Polynomials
  + Polynomials as interaction terms
  + Higher order polynomials
4. Data transformations
  + `\(\log_2\)`

---
class: inverse 
# Life expectancy at birth

.push-left[
&lt;img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4d/The_newborn_baby_in_men.jpg/1920px-The_newborn_baby_in_men.jpg" width="65%" style="display: block; margin: auto;" /&gt;&lt;img src="https://ychef.files.bbci.co.uk/976x549/p086k2k4.jpg" width="65%" style="display: block; margin: auto;" /&gt;
]

.push-right[
&lt;iframe src="https://ourworldindata.org/grapher/life-expectancy?tab=chart&amp;time=1770..2019&amp;country=Africa~Asia~Europe~OWID_WRL~Americas~Oceania" loading="lazy" style="width: 100%; height: 500px; border: 0px none;"&gt;&lt;/iframe&gt;
]
---
class: inverse 
# Is life expectacy simply a (linear) function of&lt;br&gt; how much money we spend on health?

&lt;iframe src="https://ourworldindata.org/grapher/total-healthcare-expenditure-gdp" loading="lazy" style="width: 90%; height: 450px; border: 0px none;"&gt;&lt;/iframe&gt;

---
# Preparations

.panelset[
.panel[.panel-name[Woldbank health data]

```r
pacman::p_load(
  tidyverse, # Data manipulation,
  ggplot2, # beautiful figures,
  wbstats, # download data from Worldbank. Tremendous source of global socio-economic data.
  estimatr, # OLS with robust SE
  modelsummary, # regression tables with nice layout,
  directlabels, # Labels addded to ggplot2 lines,
  rockchalk, # 3d plots of interaction effects,
  democracyData) # download democracy data used in the scholarly literature.

Dat_life &lt;- wb_data(
  # Download Life expectancy and healthcare expenditures data.
* c("SP.DYN.LE00.IN", "SH.XPD.CHEX.PP.CD"),
  start_date = 2002, end_date = 2023) %&gt;%
* rename(LifeExpect = SP.DYN.LE00.IN, # rename health variables,
*        HealthExp = SH.XPD.CHEX.PP.CD) %&gt;%
  select(country, date, LifeExpect, HealthExp) %&gt;% # Keep only 4 variables
  drop_na(LifeExpect, HealthExp) # Drop cases with missing data
```
]
.panel[.panel-name[Join citizenship rights]

```r
Dat_citi_rights &lt;- download_fh(verbose = FALSE) %&gt;% # Download Freedom House data for all countries since 1972,
  rename(country = fh_country, # rename variables,
         citizen_rights = fh_total_reversed,
         date = year) %&gt;%
  # Keep only 3 variables.
  select(country, date, citizen_rights)

# Join Worldbank Health and Citizenship rights data
Dat &lt;- inner_join(Dat_life, Dat_citi_rights, by = c("country", "date"))
```
]
.panel[.panel-name[Add socialism]
.font60[

```r
Dat &lt;- Dat %&gt;% mutate(socialist = case_when( # Years socialist minus years since,
  country == "China" ~ date - 1949,
  country == "Vietnam" ~ date - 1945,
  country == "Algeria" ~ date - 1962,
  str_detect(country,"Portugal|Bangladesh") ~ date - 1972,
  country == "Guinea-Bissau" ~ date - 1973,
  country == "India" ~ date - 1976,
  country == "Nicaragua" ~ date - 1979,
  country == "Sri Lanka" ~ date - 1978,
  country == "Tanzania" ~ date - 1964,
  country == "Albania" ~ (1992 - 1944) - (date - 1992),
  str_detect(country, "Angola|Cabo Verde|Madagascar") ~ (1992 - 1975) - (date - 1992),
  str_detect(country,"Belarus|Bulgaria") ~ (1990 - 1946) - (date - 1990),
  str_detect(country, "Benin|Mozambique") ~ (1990 - 1975) - (date - 1990),
  country == "Chad" ~ (1975 - 1962) - (date - 1975), country == "Congo, Rep." ~ (1992 - 1970) - (date - 1992),
  country == "Czech Republic" ~ (1990 - 1948) - (date - 1990), country == "Djibouti" ~ (1992 - 1981) - (date - 1992),
  country == "Ethiopia" ~ (1991 - 1974) - (date - 1991), country == "Ghana" ~ (1966 - 1960) - (date - 1966),
  country == "Guinea" ~ (1984 - 1958) - (date - 1984), country == "Hungary" ~ (1989 - 1949) - (date - 1989),
  country == "Iraq" ~ (2005 - 1958) - (date - 2005), country == "Mali" ~ (1991 - 1960) - (date - 1991),
  country == "Mauritania" ~ (1978 - 1961) - (date - 1978), country == "Mongolia" ~ (1992 - 1924) - (date - 1992),
  country == "Myanmar" ~ (1988 - 1962) - (date - 1988), country == "Poland" ~ (1989 - 1945) - (date - 1989),
  country == "Romania" ~ (1989 - 1947) - (date - 1989), country == "Russian Federation" ~ (1991 - 1922) - (date - 1991),
  country == "Seychelles" ~ (1991 - 1977) - (date - 1991), country == "Senegal" ~ (1981 - 1960) - (date - 1981),
  country == "Sierra Leone" ~ (1991 - 1978) - (date - 1991), country == "Somalia" ~ (1991 - 1969) - (date - 1991),
  country == "Sudan" ~ (1985 - 1969) - (date - 1985), country == "Syria" ~ (2012 - 1963) - (date - 2012),
  country == "Tunisia" ~ (1988 - 1964) - (date - 1988), country == "Ukraine" ~ (1991 - 1919) - (date - 1991),
  country == "Yemen, Rep." ~ (1991 - 1967) - (date - 1991), country == "Zambia" ~ (1991 - 1973) - (date - 1991),
  str_detect(country,"Slovenia|Croatia|Serbia|Montenegro|Bosnia and Herzegovina|North Macedonia|Kosovo") ~ (1992 - 1943) - (date - 1992),
  TRUE ~ 0),
  socialist = case_when( # Min. 5 years given socialist history,
    (socialist &lt; 5 &amp; socialist &gt; 0) | socialist &lt; 0 ~ 5,
    TRUE ~ socialist)) %&gt;% drop_na() # Drop countries with missing values.
```
]]
.panel[.panel-name[The resulting data]

```r
Dat
# # A tibble: 3,142 × 6
#    country      date LifeExpect HealthExp citizen_rights socialist
#    &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;
#  1 Afghanistan  2002       56.5      87.5              2         0
#  2 Afghanistan  2003       57.3      86.2              2         0
#  3 Afghanistan  2004       57.9      93.9              3         0
#  4 Afghanistan  2005       58.4     106.               4         0
#  5 Afghanistan  2006       58.7     118.               4         0
#  6 Afghanistan  2007       59.1     112.               4         0
#  7 Afghanistan  2008       59.9     138.               3         0
#  8 Afghanistan  2009       60.4     154.               2         0
#  9 Afghanistan  2010       60.9     149.               2         0
# 10 Afghanistan  2011       61.4     147.               2         0
# # ℹ 3,132 more rows
```
]]

---
class: clear
# Development of life expectancy at birth

.panelset[
.panel[.panel-name[Some country trends]
&lt;img src="12-Polys_files/figure-html/LifeExp1-1.png" width="55%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]

```r
ggplot(data = Dat %&gt;% 
         filter(country == "Denmark" | country == "Switzerland" | country == "Germany" | country == "Sweden"), 
       aes(y = LifeExpect, x = HealthExp, color = country)) +
  geom_line(alpha = 0.5) +
  geom_text(aes(label = date), size = 2.3) +
  guides(color = FALSE) +
  scale_x_continuous(expand=c(0, 1300)) +
  geom_dl(aes(label = country), method = list(dl.combine("last.points"))) +
  labs(y = "Life expectacy at birth",
       x = "Health expenditure per capita in $") +
  theme_minimal()
```
]]

---
class: inverse center middle

# Recap: Interaction effects

---
# Recap: Interaction effects

.push-left[
.font80[

```r
ols_1 &lt;- lm_robust(
  LifeExpect ~ date + socialist*citizen_rights, data = Dat,
* clusters = country) # Note that we need to specify this argument,
*# because the observations are not independent!
*# They are repeated observations of the same countries.

# 3D plot of interaction. Controls set to their mean.
plotPlane(ols_1, "citizen_rights", "socialist", 
          theta = 35, phi = 20)
```

&lt;img src="12-Polys_files/figure-html/unnamed-chunk-5-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]]

.push-right[
.font80[

```r
modelsummary(list("Life Exp." = ols_1),
             gof_map = c("nobs", "r.squared"), stars = TRUE)
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Life Exp. &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −552.190*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (44.498) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; date &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.305*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.022) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.145+ &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.082) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.127*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.169) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist × citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.015 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.010) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3142 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.248 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]

---
class: inverse center middle

# The problem: Non-linear relationships

---
# Health expenditures

.push-left[
.font80[

```r
ols_2 &lt;- lm_robust(LifeExpect ~ I(HealthExp / 1000) + # I() allows to transform x 
*                  # within model. 1 unit increase = $1000
                   date + socialist*citizen_rights, data = Dat, clusters = country)
```
&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Life Exp. &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −195.702** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (61.099) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; I(HealthExp/1000) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.177*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.468) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; date &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.128*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.030) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.128* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.064) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.497** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.155) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist × citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.007 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.007) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3142 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.481 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]

--

.push-right[
.font90[
&lt;img src="12-Polys_files/figure-html/LifeExp3-1.png" width="100%" style="display: block; margin: auto;" /&gt;

.center[.alert[This clearly violates OLS' linearity assumption!]]
]]

---
# Health expenditures .font70[The goal]

.left-column[
- We need a non-linear model:
  + Here: An initial steep increase, which progressively flattens out.]
.right-column[
&lt;img src="12-Polys_files/figure-html/LifeExp4-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

---
class: inverse center middle

# Step 1 &lt;br&gt; &lt;br&gt; .font80[Get a first impression using LOESS (locally estimated scatterplot smoothing)]

---
class: clear
# LOESS (locally estimated scatterplot smoothing)

.left-column[
- LOESS is basically a "local" regression for every observation plus the (e.g. 6) nearest observations to the left and right.
- It then combines all those regression lines into a "smoothed" "non-parametric" line.
- Beware, LOESS tends to overfit to the particular data.
]

.right-column[
.panelset[
.panel[.panel-name[LOESS fit]
&lt;img src="12-Polys_files/figure-html/LifeExp4a-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]

```r
ggplot(data = Dat, aes(y = LifeExpect, x = HealthExp)) +
  geom_point(aes(color = country), alpha = 0.5) +
  geom_line(aes(color = country), alpha = 0.3) +
  geom_dl(data = Dat %&gt;% filter(country == "Switzerland" | country == "Denmark"), 
          aes(label = country, color = country), method = list(dl.combine("last.points"))) +
* # By default geom_smooth() estimates LOESS!
* geom_smooth(color = "black") +
  labs(y = "Life expectacy at birth",
       x = "Health expenditure per capita in $") +
  theme_minimal() +
  guides(color = FALSE)
```
]]]

---
class: inverse center middle

# Modeling non-linear relations &lt;br&gt;&lt;br&gt; Possibility 1:&lt;br&gt; *Polynomials*

---
layout: true
# Polynomials

.push-left[
.font80[

```r
*ols_3 &lt;- lm_robust(LifeExpect ~ I(HealthExp/1000) + I((HealthExp/1000)^2) +
                   date + socialist*citizen_rights,
                   data = Dat, clusters = country)
```
&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Life Exp. &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −194.254*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (49.957) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; I(HealthExp/1000) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 8.167*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (1.006) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; I((HealthExp/1000)^2) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.835** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.197) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; date &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.127*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.025) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.148* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.046) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.333** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.125) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist × citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.010+ &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.005) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3142 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.610 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]

---

.push-right[
- We need a non-linear model:
  
`$$Y_{i} = \alpha + \beta_{1}X_{1} + \beta_{2}X_{1}^2 + \ldots + e_{i}$$`
.content-box-green[.center[
Do you see any similarity to the logic of an interaction term?
]]]

---

.push-right[

`$$Y_{i} = \alpha + \beta_{1}X_{1} + \beta_{2}X_{1}^2 + \ldots + e_{i}$$`

.center[Interpretation:]

`\(\beta_{\text{HealthExp}}\)`: At $0, a $1000 increase in `HealthExp` is associated with an increase in life expectancy at birth of 8.167 years.

`\(\beta_{\text{HealthExp}^2}\)`: With every $1000 increase in `HealthExp`, this association declines by -0.835 years.
 - For example, the increase from $1000 to $2000 is associated with an increase in life expectancy at birth of `\(8.167 + ( 2 \times -0.835 ) = 6.497\)` years.
]

---
layout: true
# Polynomials

.push-left[
.font80[

```r
*ols_4 &lt;- lm_robust( # Use poly() is better to specify polynomials
* LifeExpect ~ poly(I(HealthExp/1000), degree = 2, raw = TRUE) +
    date + socialist*citizen_rights, data = Dat, clusters = country)
```
&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Life Exp. &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −194.254*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (49.957) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; poly(I(HealthExp/1000), degree = 2, raw = TRUE)1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 8.167*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (1.006) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; poly(I(HealthExp/1000), degree = 2, raw = TRUE)2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.835*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.197) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; date &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.127*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.025) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.148** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.046) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.333** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.125) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist × citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.010* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.005) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3142 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.610 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]

---

.push-right[

`$$Y_{i} = \alpha + \beta_{1}X_{1} + \beta_{2}X_{1}^2 + \ldots + e_{i}$$`

.center[Interpretation:]

`\(\beta_{\text{HealthExp}}\)`: At $0, a $1000 increase in `HealthExp` is associated with an increase in life expectancy at birth of 8.167 years.

`\(\beta_{\text{HealthExp}^2}\)`: With every $1000 increase in `HealthExp`, this association declines by -0.835 years.
 - For example, the increase from $1000 to $2000 is associated with an increase in life expectancy at birth of `\(8.167 + ( 2 \times -0.835 ) = 6.497\)` years.

.center[.alert[This is complex; so plot it!]]
]

---

.push-right[
.panelset[
.panel[.panel-name[Fictional data]
.font90[

```r
(fict_dat &lt;- tibble( # 1. Make fictional data
  # Realistic variation in x: Min to max
  HealthExp = min(Dat$HealthExp):max(Dat$HealthExp), 
  # Hold other variables constant.
  socialist = 0, # Non-socialist
  citizen_rights = 12, # Max democracy
  date = 2019)) # most recent date
# # A tibble: 11,684 × 4
#    HealthExp socialist citizen_rights  date
#        &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
#  1      19.1         0             12  2019
#  2      20.1         0             12  2019
#  3      21.1         0             12  2019
#  4      22.1         0             12  2019
#  5      23.1         0             12  2019
#  6      24.1         0             12  2019
#  7      25.1         0             12  2019
#  8      26.1         0             12  2019
#  9      27.1         0             12  2019
# 10      28.1         0             12  2019
# # ℹ 11,674 more rows
```
]]
.panel[.panel-name[Predict]
.font90[

```r
(fict_dat &lt;- predict( # 2. Add predctions based on the model
  ols_4, newdata = fict_dat,
  interval = "confidence", level = 0.95)$fit %&gt;%
   as_tibble() %&gt;% # Turn into a tibble, then
   bind_cols(fict_dat, .)) # Add to the synthetic data.
# # A tibble: 11,684 × 7
#    HealthExp socialist citizen_rights  date   fit   lwr   upr
#        &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#  1      19.1         0             12  2019  65.8  63.7  67.9
#  2      20.1         0             12  2019  65.8  63.7  67.9
#  3      21.1         0             12  2019  65.8  63.7  67.9
#  4      22.1         0             12  2019  65.8  63.7  67.9
#  5      23.1         0             12  2019  65.8  63.7  67.9
#  6      24.1         0             12  2019  65.8  63.7  67.9
#  7      25.1         0             12  2019  65.8  63.7  67.9
#  8      26.1         0             12  2019  65.8  63.7  67.9
#  9      27.1         0             12  2019  65.8  63.7  67.9
# 10      28.1         0             12  2019  65.8  63.7  67.9
# # ℹ 11,674 more rows
```
]]
.panel[.panel-name[Plot]
&lt;img src="12-Polys_files/figure-html/predictions2-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Plot code]
.font90[

```r
# 3. plot the predictions
ggplot(data = fict_dat, aes(y = fit, x = HealthExp)) +
  geom_ribbon(aes(ymin = lwr, ymax = upr), alpha = 0.5) +
  geom_line() +
  geom_text(data = Dat %&gt;% # Add some exemplary countries
              filter(date == 2019 &amp; 
                       (country == "Mali" | country == "Nepal" |
                          country == "Morocco" | country == "Mexico" | 
                          country == "Poland" | country == "Japan" |
                          country == "Denmark" | country == "Switzerland" |
                          country == "United States")), 
            aes(y = LifeExpect, HealthExp, label = country)) +
  labs(title = "Predictions based on multiple OLS",
       x = "By Healthcare Expenditures in $
    (Socialism, Citizenship rights, and time held constant)",
    y = "Predicted Life expectancy at birth") +
  theme_minimal()
```
]]]]


---
layout: true
class: clear
# Higher order Polynomials .font70[Beware of overfitting!]

.push-left[
.font80[

```r
ols_5 &lt;- lm_robust(
* LifeExpect ~ poly(I(HealthExp/1000), degree = 4, raw = TRUE) +
    date + socialist*citizen_rights, data = Dat, clusters = country)
```
&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Life Exp. &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −136.416* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (54.366) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; poly(I(HealthExp/1000), degree = 4, raw = TRUE)1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 17.442*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (1.799) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; poly(I(HealthExp/1000), degree = 4, raw = TRUE)2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −5.452*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (1.016) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; poly(I(HealthExp/1000), degree = 4, raw = TRUE)3 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.691*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.196) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; poly(I(HealthExp/1000), degree = 4, raw = TRUE)4 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.030* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.012) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; date &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.097*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.027) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.148*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.037) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.278* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.119) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist × citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.012** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.004) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3142 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.670 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]

---

.push-right[
.panelset[
.panel[.panel-name[Fictional data]
.font90[

```r
(fict_dat &lt;- tibble( # 1. Make fictional data
  # Realistic variation in x: Min to max
  HealthExp = min(Dat$HealthExp):max(Dat$HealthExp), 
  # Hold other variables constant.
  socialist = 0, # Non-socialist
  citizen_rights = 12, # Max democracy
  date = 2019)) # most recent date
# # A tibble: 11,684 × 4
#    HealthExp socialist citizen_rights  date
#        &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
#  1      19.1         0             12  2019
#  2      20.1         0             12  2019
#  3      21.1         0             12  2019
#  4      22.1         0             12  2019
#  5      23.1         0             12  2019
#  6      24.1         0             12  2019
#  7      25.1         0             12  2019
#  8      26.1         0             12  2019
#  9      27.1         0             12  2019
# 10      28.1         0             12  2019
# # ℹ 11,674 more rows
```
]]
.panel[.panel-name[Predict]
.font90[

```r
(fict_dat &lt;- predict( # 2. Get predictions
  ols_5, newdata = fict_dat,
  interval = "confidence", level = 0.95)$fit %&gt;%
   as_tibble() %&gt;% # Turn into a tibble, then
   bind_cols(fict_dat, .)) # Add to the synthetic data.
# # A tibble: 11,684 × 7
#    HealthExp socialist citizen_rights  date   fit   lwr   upr
#        &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#  1      19.1         0             12  2019  62.7  60.5  64.9
#  2      20.1         0             12  2019  62.8  60.6  64.9
#  3      21.1         0             12  2019  62.8  60.6  65.0
#  4      22.1         0             12  2019  62.8  60.6  65.0
#  5      23.1         0             12  2019  62.8  60.6  65.0
#  6      24.1         0             12  2019  62.8  60.6  65.0
#  7      25.1         0             12  2019  62.8  60.7  65.0
#  8      26.1         0             12  2019  62.9  60.7  65.0
#  9      27.1         0             12  2019  62.9  60.7  65.0
# 10      28.1         0             12  2019  62.9  60.7  65.1
# # ℹ 11,674 more rows
```
]]
.panel[.panel-name[Plot]
&lt;img src="12-Polys_files/figure-html/predictions3-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Plot code]
.font90[

```r
# 3. Plot the predictions
ggplot(data = fict_dat, aes(y = fit, x = HealthExp)) +
  geom_ribbon(aes(ymin = lwr, ymax = upr), alpha = 0.5) +
  geom_line() +
  geom_text(data = Dat %&gt;% # Add some exemplary countries
              filter(date == 2019 &amp; 
                       (country == "Mali" | country == "Nepal" |
                          country == "Morocco" | country == "Mexico" | 
                          country == "Poland" | country == "Japan" |
                          country == "Denmark" | country == "Switzerland" |
                          country == "United States")), 
            aes(y = LifeExpect, HealthExp, label = country)) +
  labs(title = "Predictions based on multiple OLS",
       x = "By Healthcare Expenditures in $
        (Socialism, Citizenship rights, and time held constant)",
       y = "Predicted Life expectancy at birth") +
  theme_minimal()
```
]]]]

---

.push-right[
With a unit increase in `\(X\)`, each polynomial always alters the one before it:

`\(\beta_{\text{HealthExp}}\)`: At $0, a $1000 increase in `HealthExp` is associated with an increase in life expectancy at birth of 17.442 years.

`\(\beta_{\text{HealthExp}^2}\)`: With every $1000 increase in `HealthExp`, `\(\beta_{\text{HealthExp}}\)` changes by -5.452.

`\(\beta_{\text{HealthExp}^3}\)`: With every $1000 increase in `HealthExp`, `\(\beta_{\text{HealthExp}^2}\)` changes by `\(0.691\)`.

`\(\beta_{\text{HealthExp}^4}\)`: With every $1000 increase in `HealthExp`, `\(\beta_{\text{HealthExp}^3}\)` changes by `\(-0.03\)`.

.center[.alert[It gets super abstract; so always plot the implied association!]]
]

---
layout: false
# Polynomials .font70[in a nutshell]
`$$Y_{i} = \alpha + \beta_{1}X_{1} + \beta_{2}X_{1}^2 + \ldots + e_{i}$$`
.push-left[
.content-box-blue[
- You can best think of a polynomial as an interaction of a variable with itself.
  + Polynomials "linearize" non-linear relations.


- The more polynomials, the more complex and "wobbly" the non-linear relation.
  + Beware to not overfit the model to the particular data. .alert[In Sociology, it rarely makes sense to use higher order polynomials]


- In a multiple OLS framework, we can control for other variables.
]]

.push-right[
&lt;img src="12-Polys_files/figure-html/unnamed-chunk-21-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
class: inverse middle center
# Break

&lt;iframe src='https://www.online-timer.net/' width='400' height='385' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;

---
class: middle clear

.left-column[
&lt;img src="https://www.laserfiche.com/wp-content/uploads/2014/10/femalecoder.jpg" width="80%" style="display: block; margin: auto;" /&gt;

&lt;iframe src='https://www.online-timer.net/' width='400' height='385' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;
]

.right-column[
&lt;br&gt;
&lt;iframe src='exercise1.html' width='1000' height='600' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;
]



---
class: inverse center middle

# Modeling non-linear relations &lt;br&gt;&lt;br&gt; Possibility 2:&lt;br&gt; *Data transformation*

---
layout: true
# Transform `\(Y\)` or `\(X\)` .font70[Our favorite: The logarithm]

.push-left[
- Sometimes it helps to transform `\(Y\)` and/or `\(X\)`. Textbooks discuss many transformations. .alert[The most common and useful is log/ln.]

&lt;img src="https://helpingwithmath.com/wp-content/uploads/2021/10/Logarithms-1.png" width="60%" style="display: block; margin: auto;" /&gt;

`$$\text{Example 1: }\log_2(32)=5 \leftrightarrow 2^5 = 32$$`
`$$\text{Example 1: }\log_2(16)=4 \leftrightarrow 2^4 = 16$$`
- When we use log to the base 2, an increase of the exponent by 1 implies a doubling of the original value/argument!
]

---
.push-right[
`$$Y_{i} = \alpha + \beta \log_2(X_{i}) + e_{i}$$`
&lt;img src="12-Polys_files/figure-html/LifeExp5-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.push-right[
`$$Y_{i} = \alpha + \beta \log_2(X_{i}) + e_{i}$$`
&lt;img src="12-Polys_files/figure-html/LifeExp6-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.push-right[
`$$Y_{i} = \alpha + \beta \log_2(X_{i}) + e_{i}$$`
&lt;img src="12-Polys_files/figure-html/LifeExp7-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
layout: true
# `\(\log_2\)` transformed `\(X\)`

.push-left[
.font80[

```r
*ols_6 &lt;- lm_robust(LifeExpect ~ I(log2(HealthExp)) +
                     date + socialist*citizen_rights, data = Dat, clusters = country)
```
&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Life Exp. &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −73.836 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (47.253) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; I(log2(HealthExp)) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.590*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.193) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; date &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.055* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.024) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.110** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.040) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.175 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.125) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; socialist × citizen_rights &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.007 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.004) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3142 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.700 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]

---

.push-right[
.content-box-green[
How can we interpret the coefficient of 3.59?
]]

---

.push-right[
.panelset[
.panel[.panel-name[Fictional data]
.font90[

```r
(fict_dat &lt;- tibble( # 1. Make fictional data
  # Realistic variation in x: Min to max
  HealthExp = min(Dat$HealthExp):max(Dat$HealthExp), 
  # Hold other variables constant.
  socialist = 0, # Non-socialist
  citizen_rights = 12, # Max democracy
  date = 2019)) # most recent date
# # A tibble: 11,684 × 4
#    HealthExp socialist citizen_rights  date
#        &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;
#  1      19.1         0             12  2019
#  2      20.1         0             12  2019
#  3      21.1         0             12  2019
#  4      22.1         0             12  2019
#  5      23.1         0             12  2019
#  6      24.1         0             12  2019
#  7      25.1         0             12  2019
#  8      26.1         0             12  2019
#  9      27.1         0             12  2019
# 10      28.1         0             12  2019
# # ℹ 11,674 more rows
```
]]
.panel[.panel-name[Predict]
.font90[

```r
(fict_dat &lt;- predict( # 2. Get predictions
  ols_6, newdata = fict_dat,
  interval = "confidence", level = 0.95)$fit %&gt;%
   as_tibble() %&gt;% # Turn into a tibble, then
   bind_cols(fict_dat, .)) # Add to the synthetic data.
# # A tibble: 11,684 × 7
#    HealthExp socialist citizen_rights  date   fit   lwr   upr
#        &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#  1      19.1         0             12  2019  53.7  50.7  56.7
#  2      20.1         0             12  2019  54.0  51.0  57.0
#  3      21.1         0             12  2019  54.3  51.3  57.2
#  4      22.1         0             12  2019  54.5  51.6  57.4
#  5      23.1         0             12  2019  54.7  51.8  57.6
#  6      24.1         0             12  2019  54.9  52.1  57.8
#  7      25.1         0             12  2019  55.2  52.3  58.0
#  8      26.1         0             12  2019  55.4  52.5  58.2
#  9      27.1         0             12  2019  55.5  52.7  58.4
# 10      28.1         0             12  2019  55.7  52.9  58.5
# # ℹ 11,674 more rows
```
]]
.panel[.panel-name[Plot]
&lt;img src="12-Polys_files/figure-html/predictions4-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Plot code]
.font90[

```r
# 3. Plot the predictions
ggplot(data = fict_dat, aes(y = fit, x = HealthExp)) +
  geom_ribbon(aes(ymin = lwr, ymax = upr), alpha = 0.5) +
  geom_line() +
  geom_text(data = Dat %&gt;% # Add some exemplary countries
              filter(date == 2019 &amp; 
                       (country == "Mali" | country == "Nepal" |
                          country == "Morocco" | country == "Mexico" | 
                          country == "Poland" | country == "Japan" |
                          country == "Denmark" | country == "Switzerland" |
                          country == "United States")), 
            aes(y = LifeExpect, HealthExp, label = country)) +
  labs(title = "Predictions based on multiple OLS",
       x = "By Healthcare Expenditures in $100
        (Socialism, Citizenship rights, and time held constant)",
       y = "Predicted Life expectancy at birth") +
  theme_minimal()
```
]]]]

---
layout: false
class: clear
# Which is better polynomials or `\(\log_2(X)\)`?

.right-column[
.font80[

```
# 
# =========================================================================
#                                                Model 1       Model 2     
# -------------------------------------------------------------------------
# (Intercept)                                    -136.416 *     -73.836    
#                                                 (54.366)      (47.253)   
# poly(HealthExp/1000), degree = 4, raw = TRUE1    17.442 ***              
#                                                  (1.799)                 
# poly(HealthExp/1000), degree = 4, raw = TRUE2    -5.452 ***              
#                                                  (1.016)                 
# poly(HealthExp/1000), degree = 4, raw = TRUE3     0.691 **               
#                                                  (0.196)                 
# poly(HealthExp/1000), degree = 4, raw = TRUE4    -0.030 *                
#                                                  (0.012)                 
# date                                              0.097 ***     0.055 *  
#                                                  (0.027)       (0.024)   
# socialist                                         0.148 *       0.110 *  
#                                                  (0.037)       (0.040)   
# citizen_rights                                    0.278 *       0.175    
#                                                  (0.119)       (0.125)   
# socialist:citizen_rights                         -0.012 *      -0.007    
#                                                  (0.004)       (0.004)   
# log2(HealthExp)                                                 3.590 ***
#                                                                (0.193)   
# -------------------------------------------------------------------------
# R^2                                               0.670         0.700    
# Adj. R^2                                          0.670         0.699    
# Num. obs.                                      3142          3142        
# RMSE                                              5.071         4.839    
# N Clusters                                      168           168        
# =========================================================================
# *** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05
```
]]

--

.left-column[
- In this case, the `\(R^{2}\)` and the Adjusted `\(R^{2}\)` (which penalizes additional predictors, that is, overtly complex models) both suggest: `\(\log_2(X)\)` describes the relationship better.
- It also better fits our theoretical intuition of the process.
]

---
layout: false
class: inverse center middle

# Modeling non-linear relations &lt;br&gt;&lt;br&gt; Possibility 3:&lt;br&gt; *Generalized Linear Models with link functions*

`$$Y_{i} = g^{-1}(\alpha + \beta_{1}X_{i1} + \ldots)$$`
## Later in your studies

---
class: inverse middle center
# Break

&lt;iframe src='https://www.online-timer.net/' width='400' height='385' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;

---
class: middle clear

.left-column[
&lt;img src="https://www.laserfiche.com/wp-content/uploads/2014/10/femalecoder.jpg" width="80%" style="display: block; margin: auto;" /&gt;

&lt;iframe src='https://www.online-timer.net/' width='400' height='385' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;
]

.right-column[
&lt;br&gt;
&lt;iframe src='exercise2.html' width='1000' height='600' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;
]


---
layout: false
class: inverse
# Today's general lessons

1. Although OLS estimates linear models, we can "linearize" non-linear relationships. We can do so in two ways: by using polynomials, or by transforming `\(Y\)` or `\(X\)`.
2. Polynomials are basically interaction terms of a variable with itself. By introducing `\(X^2\)`, or even higher order polynomials to our model, we let `\(\beta_{x}\)` change with a change in `\(X\)`. Importantly, every polynomial moderates/aletrs the one before it with a unit increase in `\(X\)`. 
3. Polynomials allow us to model very complex relationships. But we should be careful to not overfit the model to our particular data. Usually, a simple polynomial (i.e. `\(x\)` and `\(X^2\)` are enough).
4. An alternative to polynomials is to transform `\(Y\)` and/or `\(X\)`. Many algebraic transformations are possible. But one of the most useful is the logarithm, which allows us to express `\(Y\)` or `\(X\)` in terms of rates of change instead of absolute unit increases.


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../template/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightLanguage": "r",
"highlightStyle": "zenburn",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
