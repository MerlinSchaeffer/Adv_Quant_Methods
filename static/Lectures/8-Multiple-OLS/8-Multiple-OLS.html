<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Multiple Regression &amp;    Fundamentals of Causal Inference</title>
    <meta charset="utf-8" />
    <meta name="author" content="Merlin Schaeffer  Department of Sociology" />
    <meta name="date" content="2024-10-30" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="../template/Merlin169.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Multiple Regression &amp; <br><br> Fundamentals of Causal Inference
]
.subtitle[
## 8. Multiple OLS regression:<br> Adjusting for <em>observed</em> confounders
]
.author[
### Merlin Schaeffer<br> Department of Sociology
]
.date[
### 2024-10-30
]

---


# Goal of empirical sociology

.font130[.center[Use data to discover patterns, &lt;br&gt; and the .alert[social mechanisms that bring them about.]]]

&lt;img src="https://liu.se/-/media/istock-501261958.jpg?mw=1120&amp;mh=1120&amp;hash=DA8977CCE6A6E600AE80A40CFEE771C9" width="70%" style="display: block; margin: auto;" /&gt;

---
class: clear
# Causal research designs and statistical estimation

.left-column[
&lt;img src="8-Multiple-OLS_files/figure-html/DAG_1-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.right-column[
&lt;img src="8-Multiple-OLS_files/figure-html/Tree1-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---
class: inverse middle
# Today's schedule

1. **Today's 1st research question**: Zero-tolerance for domestic violence re-visited.
  + Recap of IV
  
2. **Today's 2nd research question**: Terrorist attacks and xenophobia re-visited.

3. **Multiple OLS**
  
  + Omitted variable bias
  + Frisch-Waugh Theorem
  + Estimation
  
---
layout: true
# IV .font70[Zero-tolerance for domestic violence?]

.left-column[
&lt;img src="https://images.theconversation.com/files/325865/original/file-20200406-6044-hao5gp.jpg?ixlib=rb-1.1.0&amp;q=45&amp;auto=format&amp;w=1200&amp;h=675.0&amp;fit=crop" width="80%" style="display: block; margin: auto;" /&gt;&lt;img src="https://indblik.dk/wp-content/uploads/2021/06/41648075864_b1450a1d67_k.jpg" width="80%" style="display: block; margin: auto;" /&gt;
]

---

.right-column[
&lt;iframe src='https://en.wikipedia.org/wiki/Minneapolis_Domestic_Violence_Experiment' width='700' height='550' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;
]

---

.right-column[
"[...] the pains of punishment deter people from repeating the crimes for which they are punished, especially when punishment is certain, swift and severe." 

.center[versus]

"[...] punishment often makes individuals more likely to commit crimes because of altered interactional structures, foreclosed legal opportunities and secondary deviance."

-- *Source:* Sherman and Berk (1984)

.center[**Does punishment increase repeat domestic abuse?**]
]

---
layout: false
# Compliance among police officers

.panelset[
.panel[.panel-name[Intention to treat]
.push-left[
&lt;br&gt;
&lt;br&gt;



|       | Actually arrested| Actually coddled|
|:------|-----------------:|----------------:|
|Arrest |                91|                1|
|Coddle |                45|              177|


]
.push-right[
&lt;img src="https://s.abcnews.com/images/US/minneapolis-police-department-chief-search-medaria-arradondo-04-gty-llr-220621_1655836848859_hpMain_16x9_992.jpg" width="80%" style="display: block; margin: auto;" /&gt;
]
]
.panel[.panel-name[R code]

``` r
# Load the data from the Minneapolis Domestic Violence Experiment
data("mdve", package = "masteringmetrics")

mdve &lt;- mdve %&gt;%
 mutate( # Recode into factor variables with two categories
   T_RANDOM = case_when(
     T_RANDOM == 2 | T_RANDOM == 3 ~ "Coddle", # Combine categories 2 and 3 into "Coddle"
     T_RANDOM == 1 ~ "Arrest", # Category 1 becomes "Arrest"
     TRUE ~ as.character(NA)) %&gt;% # All other values become NA
     fct_relevel("Arrest"), # Make "Arrest" the reference level
   T_FINAL = case_when(
     T_FINAL == 2 | T_FINAL == 3 ~ "Actually coddled", # Combine categories 2 and 3 into "Actually coddled"
     T_FINAL == 1 ~ "Actually arrested", # Category 1 becomes "Actually arrested"
     TRUE ~ as.character(NA)) %&gt;% # All other values become NA
     fct_relevel("Actually arrested")) # Make "Actually arrested" the reference level

mdve %&gt;%
 select(T_RANDOM, T_FINAL) %&gt;% # Select only the treatment variables
 table() %&gt;% kable() # Create a cross-tabulation of the two variables
```
]]

---
layout: false
# IV .font60[to the rescue]

.left-column[.content-box-red[
.center[**3 Requirements**]
1. *First stage*: Instrument `\(Z_{i}\)` has causal effect on `\(D_{i}\)`.

2. *Randomization*: Instrument `\(Z_{i}\)` is randomly assigned (RCT or natural experiment).

3. *Exclusion restriction*: Instrument `\(Z_{i}\)` affects outcome `\(Y_{i}\)` **_only_** through its effect on `\(D_{i}\)`.
]]

.right-column[
&lt;br&gt;

.push-left[
&lt;img src="8-Multiple-OLS_files/figure-html/DAG8-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/DAG9-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.font60[.]
**Reduced Form (or ITT):** `\(\beta_{Z \rightarrow Y} = E[Y_{i}|Z_{i}=1]-E[Y_{i}|Z_{i}=0]; \text{call this }\rho.\)`

**First Stage:** `\(\beta_{Z \rightarrow D} = E[D_{i}|Z_{i}=1]-E[D_{i}|Z_{i}=0]; \text{call this }\phi.\)`

**IV Estimator of** `\(\lambda = \frac{\beta_{Z \rightarrow Y}}{\beta_{Z \rightarrow D}} = \frac{E[Y_{i}|Z_{i}=1]-E[Y_{i}|Z_{i}=0]}{E[D_{i}|Z_{i}=1]-E[D_{i}|Z_{i}=0]} = \frac{\rho}{\phi}.\)`
]

---
# IV .font60[to the rescue]

.push-right[
.panelset[
.panel[.panel-name[First Stage].font90[
&lt;table style="NAborder-bottom: 0; color: black; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; First stage &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.011 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.011) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; T_RANDOMCoddle &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.786*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.029) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 314 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.522 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]
.panel[.panel-name[R code]

``` r
mdve &lt;- mdve %&gt;%
  mutate( # Code binary D
    T_FINAL_01 = case_when(
    # Code "Actually Arrested" as 0
    T_FINAL == "Actually arrested" ~ 0, 
    # Code "Actually Coddled" as 1
    T_FINAL == "Actually coddled" ~ 1)) 

# First stage OLS
first_stg &lt;- lm_robust(T_FINAL_01 ~ T_RANDOM, 
                        data = mdve)

# Regression table
modelsummary(list("First stage" = first_stg), 
             stars = TRUE,
             gof_map = c("nobs", "r.squared"), 
             output = "kableExtra")
```
]]]

.push-left[
.push-left[
&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.font60[.]

**Reduced Form (or ITT):** `\(\rho = 0.114\)` .backgrnote[According to Sherman and Berk (1984).]

**First Stage:** `\(\phi = 0.786.\)`

**IV Estimator of LATE:** `\(\lambda = \frac{\rho}{\phi} = \frac{E[Y_{i}|Z_{i}=1]-E[Y_{i}|Z_{i}=0]}{E[D_{i}|Z_{i}=1]-E[D_{i}|Z_{i}=0]} = \underline{\underline{0.145}} \color{red}{|\text{Complier}_{i}=1}.\)`
]

---
class: inverse middle center
# Research question two of the day

.right-column[
&lt;img src="https://api.time.com/wp-content/uploads/2019/07/gettyimages-1064896696.jpg" width="60%" style="display: block; margin: auto;" /&gt;&lt;img src="https://www.brookings.edu/wp-content/uploads/2019/07/Denmark.jpg?w=1200&amp;h=630&amp;crop=1" width="60%" style="display: block; margin: auto;" /&gt;
]

.left-column[
.font130[
**What is the** 

**average causal effect**

**of terrorist attacks on xenophobia?**
]]

---
# We need an RCT!

.push-left[
&lt;img src="./img/randomization2.png" width="60%" style="display: block; margin: auto;" /&gt;

If we *randomly* divide subjects into treatment and control groups, .alert[they come from the same underlying population]. 
    &lt;br&gt; &lt;br&gt; `\(\rightarrow\)` They will be similar, on average, *in every way*;&lt;br&gt; **including their `\(Y_{0}\)` **!
    &lt;br&gt; &lt;br&gt; `\(\rightarrow E[Y_{0i}|D=1] = E[Y_{0i}|D=0]\)`!
    
**Beware**, in practice randomization can fail, especially if your sample is small.
]

.push-right[

`$$\begin{equation}\begin{split} &amp;  \underbrace{E[Y_{1i}|D=1] - E[Y_{0i}|D=0]}_{\text{Comparison between treatment and control group}} \\  \\ &amp; = E[Y_{0i} + \color{red}{\kappa} |D=1] - E[Y_{0i}|D=0], \\ \\ &amp;= \color{red}{\kappa} + \underbrace{E[Y_{0i} |D=1] - E[Y_{0i}|D=0]}_{\underbrace{0}_{\text{Selection bias (if randomization has worked)}}}, \\ \\ &amp; = \underbrace{\color{red}{\kappa}.}_{\text{The average causal effect}} \end{split}\end{equation}$$`
]

---
layout: true
# My friend Joscha had an idea

.left-column[
&lt;br&gt;

&lt;img src="https://www.wzb.eu/files/styles/4_column_content_lg/public/image/dsi/aam/wzbjahresbericht3836-smaller.jpg?itok=_G0nt5M9" width="60%" style="display: block; margin: auto;" /&gt;

]

---

.right-column[
&lt;img src="./img/Joscha2.png" width="100%" style="display: block; margin: auto;" /&gt;
.center[.backgrnote[*Source:* Legewie (2013)]]

.content-box-green[.center[
What are the two key assumptions that ensure the comparability of treatment and control groups?
]]]

---

.right-column[
&lt;img src="./img/Joscha2.png" width="100%" style="display: block; margin: auto;" /&gt;
.center[.backgrnote[*Source:* Legewie (2013)]]

.alert[Assumption 1]: The European Social Survey is based on random sampling. .alert[The day of] `\(i\)`.alert['s interview is also random!]

- *Reachability bias*: Respondents who are easier to contact tend to be interviewed earlier during the survey period.

.alert[Assumption 2]: No other event had a causal effect on `\(Y_{i}\)`.
]

---
layout: false
# Balance?

.left-column[
`$$E[Y_{0i}|D=1] = E[Y_{0i}|D=0]?$$`

&lt;img src="8-Multiple-OLS_files/figure-html/DAG_NatExp-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]

.right-column[
&lt;img src="./img/Joscha3.png" width="100%" style="display: block; margin: auto;" /&gt;
.center[.backgrnote[*Source:* Legewie (2013)]]

"[Across all countries] The treatment group is on average slightly younger, and the proportion of people who are retired and who work from home is lower." 

-- Legewie (2013, page 1211).

]

---
class: clear
# Example: Age as confounder

.left-column[
1. On average, xenophobia increases with age.

2. The younger a respondent, the more likely they are exposed to the Bali attack.

`\(\Rightarrow E[Y_{0i}|D=0] \color{red}{&gt;} E[Y_{0i}|D=1]\)` 

.backgrnote[
Note that in Portugal, older respondents were more likely to be in the treatment group.
`\(\rightarrow E[Y_{0i}|D=0] \color{red}{&lt;} E[Y_{0i}|D=1]\)` 
]]

.right-column[
&lt;img src="8-Multiple-OLS_files/figure-html/DAG_Age-1.png" width="80%" style="display: block; margin: auto;" /&gt;

.content-box-green[.center[
What kind of bias does this imply for our terrorist-attack estimate? Is our estimate likely too large or too small?
]]]

---
class: inverse middle center
# Multiple OLS Regression


`$$y_{i} = \alpha + \beta_{1}x_{1} + \beta_{2}x_{2} + \ldots + \beta_{k}x_{k} + \epsilon_{i}$$`

---
# A Simulated Example

.panelset[
.panel[.panel-name[Packages]

``` r
pacman::p_load(
  tidyverse, # Data manipulation,
  haven, # Read Stata data,
  furniture, # For row-means,
  ggplot2, # beautiful figures,
  estimatr, # Regression for weighted data,
  modelr, # Turn results of lm() into a tibble,
  modelsummary) # for balance and regression tables.
```
]
.panel[.panel-name[Simulated: Age]
.push-left[



``` r
toydat &lt;- tibble( 
  age = rnorm( # Simulate random gauss-distributed age
  n = 500, # for 500 ficticious people,
  mean = 40, # Average age 45,
  sd = 5)) # SD of 10 years.
```
]

.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-16-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]]
.panel[.panel-name[Exposure to terror]
.push-left[.font70[

``` r
toydat &lt;- toydat %&gt;% 
  mutate( # Day of interview: Age + random.
    int_day = (-0.1*age) + rnorm(n = 500, mean = 0, sd = 1),
    bali = case_when(int_day &lt; mean(int_day) ~ 0, # Not Bali: Before mean int_day
      int_day &gt;= mean(int_day) ~ 1)) # Bali: After mean int_day.

ols &lt;- lm_robust(bali ~ age, data = toydat)
modelsummary(list("Day of Interview" = ols), stars = TRUE,
             gof_map = c("nobs", "r.squared"), output = "kableExtra")
```

&lt;table style="NAborder-bottom: 0; color: black; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; &amp;amp;nbsp;Day of Interview &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.917*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.157) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; age &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.035*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.004) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 500 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.108 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]
.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-18-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]
]
.panel[.panel-name[Xenophobia]
.push-left[

``` r
# Because I simulate the data for this example,
# I define: Xenophobia is a linear function of:
# exposure to Bali, age, and a random part.
toydat &lt;- toydat %&gt;%
* mutate(xeno = (1 * bali) + (0.3 * age) +
        rnorm(n = 500, mean = 0, sd = 1))
```
]
.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-20-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]]]

---
# What's going on here?

.push-left[

``` r
# Bivariate OLS
ols_bi &lt;- lm_robust(xeno ~ bali, data = toydat)

# Multiple OLS
ols_mult &lt;- lm_robust(xeno ~ bali + age, data = toydat)

# Regression table of both results
modelsummary(list(
              "Biv. OLS" = ols_bi, 
              "Mult. OLS" = ols_mult), 
              stars = TRUE, 
              gof_map = c("nobs", "r.squared"), 
              output = "kableExtra")
```

.content-box-green[
Which of the two models is correct?
]]

.push-right[
&lt;table style="NAborder-bottom: 0; color: black; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Biv. OLS &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Mult. OLS &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 12.495*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.123* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.101) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.447) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; bali &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.185 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.025*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.141) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.096) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; age &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.274*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.011) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 500 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 500 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.003 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.589 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]

---
class: clear
# Omitted variable (selection/confounder) bias

.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]


.push-left[
.center[When we compare Xenophobia between those exposed to Bali and those who were not:]

1. We .alert[know] that one part of the difference is the causal effect `\(\beta_{\text{sample}} = 1 + \underbrace{\sigma}_{\text{Sampling error}} = 1.025\)`.

.content-box-green[
- Why do we .alert[know] that in this example?

- What else is different between those exposed to Bali and those who were not?
]]

---
class: clear
# Omitted variable (selection/confounder) bias

.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-23-1.png" width="70%" style="display: block; margin: auto;" /&gt;
.font80[
&lt;table style="NAborder-bottom: 0; color: black; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Age &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 41.546*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.289) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; bali &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −3.070*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.395) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 500 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.108 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]

.push-left[
.center[When we compare Xenophobia between those with Bali = 0 to those with Bali = 1 in our simulated toy data:]

1. We .alert[know] that one part of the difference is the causal effect `\(\beta_{\text{sample}} = 1 + \underbrace{\sigma}_{\text{Sampling error}} = 1.025\)`.

2. We compare between people who have an average age difference of `\(\beta_{E \rightarrow C} = -3.07\)` years.

.content-box-green[
On average, to how much Xenophobia do -3.07 years of age amount?
]
]

---
class: clear
# Omitted variable (selection/confounder) bias

.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-25-1.png" width="70%" style="display: block; margin: auto;" /&gt;
.font80[
&lt;table style="NAborder-bottom: 0; color: black; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Biv. OLS &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Mult. OLS &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 12.495*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.123* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.101) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.447) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; bali &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.185 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.025*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.141) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.096) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; age &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.274*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.011) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 500 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 500 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.003 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.589 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]

.push-left[
.center[When we compare Xenophobia between those with Bali = 0 to those with Bali = 1 in our simulated toy data:]

1. We .alert[know] that one part of the difference is the causal effect `\(\beta_{\text{sample}} = 1 + \underbrace{\sigma}_{\text{Sampling error}} = 1.025\)`.

2. We compare between people who have an average age difference of `\(\beta_{E \rightarrow C} = -3.07\)` years.

.font80[Because of this age difference, Xenophobia additionally differs by:]

`\(\begin{equation}\begin{split} &amp; -3.07 \times (0.3 + \sigma) \\ = &amp; -3.07 \times 0.274, \\ = &amp; -0.84. \end{split}\end{equation}\)`

.content-box-green[
What is the result if we take 1. and 2. together?
]
]

---
# Omitted variable bias

.push-left[
.content-box-red[
&lt;img src="8-Multiple-OLS_files/figure-html/DAG_OMV-1.png" width="40%" style="display: block; margin: auto;" /&gt;

`$$\tilde{\beta}_{D \rightarrow Y} = \beta_{D \rightarrow Y} + \underbrace{(\beta_{C \rightarrow Y} \times \beta_{D \rightarrow C})}_{\text{Omitted Variable Bias (OVB)}}$$`
]]

--

.push-right[
&lt;br&gt;

.font90[
&lt;table style="NAborder-bottom: 0; color: black; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Biv. OLS &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Mult. OLS &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 12.495*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.123* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.101) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.447) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; bali &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.185 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.025*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.141) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.096) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; age &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.274*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.011) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 500 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 500 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.003 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.589 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]
`$$0.185 = 1.025 + \underbrace{(\underbrace{0.274}_{\beta_{C \rightarrow Y}} \times \underbrace{-3.07}_{\beta_{D \rightarrow C}})}_{\text{OVB} = -0.84}$$`
]

---
class: inverse middle

.push-left[
&lt;img src="https://st.depositphotos.com/1654249/2526/i/600/depositphotos_25269433-stock-photo-3d-man-with-red-question.jpg
" width="80%" style="display: block; margin: auto;" /&gt;
]

.push-right[
But how does multiple OLS get the correct `\(\beta_{Y \leftarrow D}\)`?
]

---
class: inverse middle center
# Break

&lt;iframe src='https://www.online-timer.net/' width='400' height='385' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;

---
layout: true
# Frisch-Waugh Theorem

.left-column[
Frisch and Waugh (1933) demonstrated that "controlling" for a confounder is mathematically equivalent to a three-step procedure.

&lt;img src="8-Multiple-OLS_files/figure-html/DAG_FrischWaugh-1.png" width="60%" style="display: block; margin: auto;" /&gt;
.backgrnote[The double circle indicates that we control for a confounder, thereby effectively closing that backdoor path.]
]

---

---

.right-column[
.center[
**Step 1: Regress `\(Y\)` on `\(C\)`, then keep residuals.**
]
.push-left[
.font80[

``` r
# Regress xeno on age,
(toydat &lt;- lm_robust(xeno ~ age, data = toydat) %&gt;%
   # Get residuals,
   add_residuals(toydat, model = .) %&gt;% 
   rename(e_xeno = resid)) # Rename residuals.
# # A tibble: 500 × 5
#      age int_day  bali  xeno e_xeno
#    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
#  1  42.5   -3.90     1  13.4  0.251
#  2  45.3   -5.10     0  12.6 -1.27 
#  3  42.7   -2.89     1  14.5  1.25 
#  4  37.1   -4.40     0  10.9 -1.02 
#  5  47.5   -5.80     0  12.8 -1.54 
#  6  47.0   -4.28     0  14.5  0.300
#  7  36.7   -3.64     1  12.0  0.146
#  8  44.1   -4.55     0  10.3 -3.28 
#  9  31.7   -2.12     1  10.0 -0.615
# 10  36.5   -2.81     1  12.3  0.588
# # ℹ 490 more rows
```
]]
.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/residuals-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.content-box-green[.center[
What is `e_xeno`?
]]]

---

.right-column[
.center[
**Step 2: Regress `\(D\)` on `\(C\)`, then keep residuals.**
]
.push-left[
.font80[

``` r
# Regress xeno on age,
(toydat &lt;- lm_robust(bali ~ age, data = toydat) %&gt;%
   # Get residuals,
   add_residuals(toydat, model = .) %&gt;%
   rename(e_bali = resid)) # Rename residuals.
# # A tibble: 500 × 6
#      age int_day  bali  xeno e_xeno e_bali
#    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
#  1  42.5   -3.90     1  13.4  0.251  0.582
#  2  45.3   -5.10     0  12.6 -1.27  -0.318
#  3  42.7   -2.89     1  14.5  1.25   0.590
#  4  37.1   -4.40     0  10.9 -1.02  -0.609
#  5  47.5   -5.80     0  12.8 -1.54  -0.243
#  6  47.0   -4.28     0  14.5  0.300 -0.261
#  7  36.7   -3.64     1  12.0  0.146  0.378
#  8  44.1   -4.55     0  10.3 -3.28  -0.360
#  9  31.7   -2.12     1  10.0 -0.615  0.201
# 10  36.5   -2.81     1  12.3  0.588  0.369
# # ℹ 490 more rows
```
]]
.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/residuals2-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.content-box-green[.center[
What is `e_bali`?
]]]

---

.right-column[
.center[
**Step 3: Regress `\(e_{Y}\)` on `\(e_{D}\)`.**
]
.push-left[
.font70[

``` r
# Regress xeno on age,
ols_e &lt;- lm_robust(e_xeno ~ e_bali,
                    data = toydat)

modelsummary(list(
              "Resid. OLS" = ols_e), 
            stars = TRUE,
            gof_map = c("nobs", "r.squared"), 
            output = "kableExtra")
```

&lt;table style="NAborder-bottom: 0; color: black; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Resid. OLS &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.045) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; e_bali &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.025*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.096) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 500 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.187 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]
.push-right[
&lt;img src="8-Multiple-OLS_files/figure-html/residuals3-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]]

---
layout: false
class: inverse center

# Why multiple OLS

.push-left[.left[
- Allows estimation of `\(\beta_{D \rightarrow Y}\)`, controlling for **_observed_** confounding variables.

- Multiple OLS can identify the average causal effect `\(\kappa_{D \rightarrow Y}\)` if it blocks all backdoor paths.

&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-32-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]]

--

.push-right[.left[.font80[
- You can think of multiple OLS as down-weighting typical cases (e.g. young people exposed to Bali) and up-weighting untypical cases (older people exposed to Bali)

- Because of this weighting, multiple OLS increases the random variation in `\(D\)`.
]]

&lt;img src="8-Multiple-OLS_files/figure-html/residuals2-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

---
# Estimation: Still OLS

.push-left[
The best (now multidimensional) "line" is defined by an overall intercept `\(\alpha\)` (i.e. `\(\bar{Y}\)` when all predictors are zero) and multiple slope coefficients `\(\beta_{1} \ldots \beta_{k}\)`.

`$$\begin{align*}
      \min \text{RSS} &amp;= \min \sum_{i=1}^{n} e_{i}^{2} \\
      &amp;= \min \sum_{i=1}^{n} y_{i} - \hat{y_{i}} \\
      &amp;= \min \sum_{i=1}^{n} (y_{i} - (\color{orange}{\alpha} + \color{orange}{\beta_{1}} x_{1i} + \ldots + \color{orange}{\beta_{k}} x_{ki})^{2}
    \end{align*}$$`

.content-box-red[
- Multiple OLS assumes linear relations between all variables.

- Multiple OLS adjusts *all* variables for each other.
]
]

.push-right[
.center[**Frisch-Waugh as DAG**]

&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-33-1.png" width="60%" style="display: block; margin: auto;" /&gt;

]

---
class: clear
# Can multiple OLS fix broken interventions?

.push-left[.content-box-green[

&lt;img src="8-Multiple-OLS_files/figure-html/unnamed-chunk-34-1.png" width="40%" style="display: block; margin: auto;" /&gt;

- OLS can statistically balance **_observed_** confounders, even after the data has been collected.
]]

.push-right[.content-box-red[

&lt;img src="8-Multiple-OLS_files/figure-html/DAG_FrischWaugh2-1.png" width="40%" style="display: block; margin: auto;" /&gt;

- If **_observed_** confounders are imbalanced, *maybe more is broken than what we have observed?*
]]

---
# Back to Bali .font70[The Portuguese subsample]



.panelset[
.panel[.panel-name[Balance table]
.left-column[
.content-box-green[
- What do we learn from this balance table?

- What does it suggest about the direction of the omitted age bias among Portuguese? (Assuming that xenophobia also increases with age in Portugal?)
]]
.right-panel[
&lt;table class="table" style="color: black; width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Xeno and age by those who were (not) exposed to Bali&lt;/caption&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;Before Bali (N=187)&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;After Bali (N=104)&lt;/div&gt;&lt;/th&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="2"&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Mean &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Std. Dev. &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Mean &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Std. Dev. &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Diff. in Means &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Std. Error &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; age &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45.8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17.6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; anti_immi &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


]]
.panel[.panel-name[R code]

``` r
ESS %&gt;%
  # Focus on Portuguese respondents
  filter(cntry == "PT") %&gt;%
  # Select variables for which I want my balance test,
  select(age, anti_immi, treat, pspwght) %&gt;%
* rename(weights = pspwght) %&gt;% # Rename the weights variable!
* datasummary_balance( # Make a balance table,
*   formula = ~ treat, # by exposure to Bali
*   data = . ,
*   title = "Xeno and age by those who were (not) exposed to Bali",
    output = "kableExtra") # Specify the output format as kableExtra 
```
]]

---
class: clear
# Controlling for *observed* confounders

.left-column[
Alternative names for "controlling for `\(X\)`": 
  + Partialling out `\(X\)`,
  + Adjusted for `\(X\)`,
  + Conditional on `\(X\)`.
]

.right-column[
&lt;img src="./img/Joscha5.png" width="100%" style="display: block; margin: auto;" /&gt;
.center[.backgrnote[*Source:* Legewie (2013, page 1210).]]
]

---
class: clear
# Learning goal 1 .font60[Terror attacks can increase xenophobia]

.push-left[
.font80[

``` r
# Estimate the treatment effect with OLS
ols_pt_bi &lt;- lm_robust(anti_immi ~ treat, weights = pspwght,
                       data = ESS %&gt;% filter(cntry == "PT"))
ols_pt_mult &lt;- lm_robust(anti_immi ~ treat + age, weights = pspwght,
                         data = ESS %&gt;% filter(cntry == "PT"))
# Report results in a nicely-formatted table
modelsummary(list("Biv. OLS" = ols_pt_bi, "Mult. OLS" = ols_pt_mult), stars = TRUE,
             gof_map = c("nobs", "r.squared"), output = "kableExtra")
```

&lt;table style="NAborder-bottom: 0; color: black; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Biv. OLS &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Mult. OLS &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.621*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.328*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.082) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.175) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; treatAfter Bali &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.330** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.313** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.116) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.118) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; age &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.006+ &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.003) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 291 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 291 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.032 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.050 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;


]]

.push-right[
.panelset[
.panel[.panel-name[Coefficient plot]
&lt;img src="8-Multiple-OLS_files/figure-html/coefplotPT-1.png" width="90%" style="display: block; margin: auto;" /&gt;



`$$\tilde{\beta}_{D \rightarrow Y} = \underbrace{0.313}_{\beta_{D \rightarrow Y}} + \underbrace{(\underbrace{2.6}_{\beta_{D \rightarrow C}} \times \underbrace{0.006}_{\beta_{C \rightarrow Y}})}_{\text{OVB}} = 0.33$$`
]
.panel[.panel-name[R code]

``` r
bind_rows(ols_pt_bi %&gt;% tidy(),  # Combine the tidy output of two models 
          ols_pt_mult %&gt;% tidy(),  # ...
          .id = "model") %&gt;%  # Add an identifier for each model
  filter(term == "treatAfter Bali") %&gt;%  # Select the row corresponding to the treatment effect
  mutate(model = case_when(  # Change the model identifier to more informative labels
    model == 1 ~ "Bivariate",
    model == 2 ~ "Adjusted for age")) %&gt;%
  ggplot(aes(y = estimate, x = model,  # Set up the plot with estimate on the y-axis and model on the x-axis
             ymin = conf.low, ymax = conf.high)) +  # Specify the confidence intervals
  geom_hline(yintercept = 0,  # Add a horizontal line at zero
             color = "orange", lty = "dashed") +  # ...
  geom_pointrange() +  # Add points with confidence intervals
  coord_flip() +  # Flip the coordinates
  labs(
    title = "Causal effect of Bali 2002 terror attack among the Portugese",  # Add a title
    y = "Standardized difference in xenophobia\ncompared to respondents interviewed before the attack",  # Add a y-axis label
    x = "") +  # Remove the x-axis label
  theme_minimal()  # Use a minimal theme
```
]]]

---
layout: false
class: clear
# Learning goal 1 .font60[Terror attacks can increase xenophobia]

.right-column[
&lt;img src="./img/Joscha4.png" width="60%" style="display: block; margin: auto;" /&gt;
.center[.backgrnote[*Source:* Legewie (2013)]]
]

.left-column[
These results are adjusted for several further variables. Now it's your turn to repliacte that.
]

---
class: inverse middle center
# Break

&lt;iframe src='https://www.online-timer.net/' width='400' height='385' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;

---
class: middle clear

.left-column[
&lt;img src="https://www.latentview.com/wp-content/uploads/2016/04/LatentView-Turns-Ten-A-decade-of-data-science.jpg" width="100%" style="display: block; margin: auto;" /&gt;

&lt;iframe src='https://www.online-timer.net/' width='400' height='385' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;
]

.right-column[
&lt;br&gt;
&lt;iframe src='exercise1.html' width='1000' height='600' frameborder='0' scrolling='yes'&gt;&lt;/iframe&gt;
]


---
class: inverse
# Today's general lessons

1. *Omitted variable bias*. Confounder variables can introduce omitted variable bias, which can be estimated if the confounder is observed in the data. Omitted variable bias is essentially the same as selection bias or confounder bias. However, the term "omitted variable bias" typically refers to a specific variable, while the terms "selection bias" and "confounder bias" refer to the problem in general.

2. *Controlling for*: Multiple OLS allows us to partially adjust for the selection biases that arise from observed confounding variables.

3. *Frisch-Waugh Theorem*: We can think of controlling for as working with the residuals (leftovers) after the correlations between the confounders and both `\(Y\)` and `\(D\)` have been controlled for.

4. *Multiple OLS*: OLS allows us to consider multiple predictor variables. In accordance with Frisch-Waugh, they are all adjusted for each other.

5. Multiple OLS can thus reduce the imbalance of confounders and thereby "repair" broken randomization. However, OLS can only consider **_observed_** confounders, so it remains unclear whether a failed randomization is truly fixed.

6. We can also control for confounders in an instrumental variables (IV) setting. In this case, *we need to adjust for both the first stage and the reduced form for confounders*.


---
# References

.font80[
Frisch, R. and F. V. Waugh (1933). "Partial Time Regressions as Compared with Individual Trends". In:
_Econometrica_, pp. 387-401.

Legewie, J. (2013). "Terrorist Events and Attitudes toward Immigrants: A Natural Experiment". In:
_American Journal of Sociology_, pp. 1199-1245.

Sherman, L. W. and R. A. Berk (1984). "The Specific Deterrent Effects of Arrest for Domestic Assault".
In: _American Sociological Review_, pp. 261-272.
]

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../template/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightLanguage": "r",
"highlightStyle": "zenburn",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
